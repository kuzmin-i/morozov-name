{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nvar _extends = require('@babel/runtime/helpers/extends');\n\nvar _objectWithoutPropertiesLoose = require('@babel/runtime/helpers/objectWithoutPropertiesLoose');\n\nvar _construct = require('@babel/runtime/helpers/construct');\n\nvar THREE = require('three');\n\nvar Reconciler = require('react-reconciler');\n\nvar scheduler = require('scheduler');\n\nvar React = require('react');\n\nvar tinyEmitter = require('tiny-emitter');\n\nvar useAsset = require('use-asset');\n\nvar useMeasure = require('react-use-measure');\n\nvar mergeRefs = require('react-merge-refs');\n\nfunction _interopDefaultLegacy(e) {\n  return e && typeof e === 'object' && 'default' in e ? e : {\n    'default': e\n  };\n}\n\nfunction _interopNamespace(e) {\n  if (e && e.__esModule) return e;\n  var n = Object.create(null);\n\n  if (e) {\n    Object.keys(e).forEach(function (k) {\n      if (k !== 'default') {\n        var d = Object.getOwnPropertyDescriptor(e, k);\n        Object.defineProperty(n, k, d.get ? d : {\n          enumerable: true,\n          get: function () {\n            return e[k];\n          }\n        });\n      }\n    });\n  }\n\n  n['default'] = e;\n  return Object.freeze(n);\n}\n\nvar _extends__default = /*#__PURE__*/_interopDefaultLegacy(_extends);\n\nvar _objectWithoutPropertiesLoose__default = /*#__PURE__*/_interopDefaultLegacy(_objectWithoutPropertiesLoose);\n\nvar _construct__default = /*#__PURE__*/_interopDefaultLegacy(_construct);\n\nvar THREE__namespace = /*#__PURE__*/_interopNamespace(THREE);\n\nvar Reconciler__default = /*#__PURE__*/_interopDefaultLegacy(Reconciler);\n\nvar React__default = /*#__PURE__*/_interopDefaultLegacy(React);\n\nvar useMeasure__default = /*#__PURE__*/_interopDefaultLegacy(useMeasure);\n\nvar mergeRefs__default = /*#__PURE__*/_interopDefaultLegacy(mergeRefs);\n\nvar name = \"react-three-fiber\";\nvar version = \"5.3.19\";\nvar roots = new Map();\nvar emptyObject = {};\nvar is = {\n  obj: function obj(a) {\n    return a === Object(a) && !is.arr(a);\n  },\n  fun: function fun(a) {\n    return typeof a === 'function';\n  },\n  str: function str(a) {\n    return typeof a === 'string';\n  },\n  num: function num(a) {\n    return typeof a === 'number';\n  },\n  und: function und(a) {\n    return a === void 0;\n  },\n  arr: function arr(a) {\n    return Array.isArray(a);\n  },\n  equ: function equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    var i;\n\n    for (i in a) {\n      if (!(i in b)) return false;\n    }\n\n    for (i in b) {\n      if (a[i] !== b[i]) return false;\n    }\n\n    return is.und(i) ? a === b : true;\n  }\n};\n\nfunction createSubs(callback, subs) {\n  var index = subs.length;\n  subs.push(callback);\n  return function () {\n    return void subs.splice(index, 1);\n  };\n}\n\nvar globalEffects = [];\nvar globalAfterEffects = [];\nvar globalTailEffects = [];\n\nvar addEffect = function addEffect(callback) {\n  return createSubs(callback, globalEffects);\n};\n\nvar addAfterEffect = function addAfterEffect(callback) {\n  return createSubs(callback, globalAfterEffects);\n};\n\nvar addTail = function addTail(callback) {\n  return createSubs(callback, globalTailEffects);\n};\n\nfunction renderGl(state, timestamp, repeat, runGlobalEffects) {\n  if (repeat === void 0) {\n    repeat = 0;\n  }\n\n  if (runGlobalEffects === void 0) {\n    runGlobalEffects = false;\n  }\n\n  var i; // Run global effects\n\n  if (runGlobalEffects) {\n    for (i = 0; i < globalEffects.length; i++) {\n      globalEffects[i](timestamp);\n      repeat++;\n    }\n  } // Run local effects\n\n\n  var delta = state.current.clock.getDelta();\n\n  for (i = 0; i < state.current.subscribers.length; i++) {\n    state.current.subscribers[i].ref.current(state.current, delta);\n  } // Decrease frame count\n\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual && state.current.gl.render) state.current.gl.render(state.current.scene, state.current.camera); // Run global after-effects\n\n  if (runGlobalEffects) {\n    for (i = 0; i < globalAfterEffects.length; i++) {\n      globalAfterEffects[i](timestamp);\n    }\n  }\n\n  return repeat;\n}\n\nvar running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  var repeat = 0;\n  var i; // Run global effects\n\n  for (i = 0; i < globalEffects.length; i++) {\n    globalEffects[i](timestamp);\n    repeat++;\n  }\n\n  roots.forEach(function (root) {\n    var state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) {\n      repeat = renderGl(state, timestamp, repeat);\n    } else {\n      repeat = 0;\n    }\n  }); // Run global after-effects\n\n  for (i = 0; i < globalAfterEffects.length; i++) {\n    globalAfterEffects[i](timestamp);\n  }\n\n  if (repeat !== 0) {\n    return requestAnimationFrame(renderLoop);\n  } else {\n    // Tail call effects, they are called when rendering stops\n    for (i = 0; i < globalTailEffects.length; i++) {\n      globalTailEffects[i](timestamp);\n    }\n  } // Flag end of operation\n\n\n  running = false;\n}\n\nfunction invalidate(state, frames) {\n  if (state === void 0) {\n    state = true;\n  }\n\n  if (frames === void 0) {\n    frames = 1;\n  }\n\n  if (state === true) {\n    roots.forEach(function (root) {\n      var state = root.containerInfo.__state;\n      state.current.frames = state.current.ready ? state.current.frames + frames : frames;\n    });\n  } else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = state.current.ready ? state.current.frames + frames : frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\n\nfunction forceResize() {\n  roots.forEach(function (root) {\n    return root.containerInfo.__state.current.forceResize();\n  });\n}\n\nvar catalogue = {};\n\nvar extend = function extend(objects) {\n  return void (catalogue = _extends__default['default']({}, catalogue, objects));\n};\n\nfunction applyProps(instance, newProps, oldProps, accumulative) {\n  if (oldProps === void 0) {\n    oldProps = {};\n  }\n\n  if (accumulative === void 0) {\n    accumulative = false;\n  } // Filter equals, events and reserved props\n\n\n  var container = instance.__container;\n  var sameProps = [];\n  var handlers = [];\n  var i;\n  var keys = Object.keys(newProps);\n\n  for (i = 0; i < keys.length; i++) {\n    if (is.equ(newProps[keys[i]], oldProps[keys[i]])) {\n      sameProps.push(keys[i]);\n    } // Event-handlers ...\n    //   are functions, that\n    //   start with \"on\", and\n    //   contain the name \"Pointer\", \"Click\", \"ContextMenu\", or \"Wheel\"\n\n\n    if (is.fun(newProps[keys[i]]) && keys[i].startsWith('on')) {\n      if (keys[i].includes('Pointer') || keys[i].includes('Click') || keys[i].includes('ContextMenu') || keys[i].includes('Wheel')) {\n        handlers.push(keys[i]);\n      }\n    }\n  }\n\n  var leftOvers = [];\n  keys = Object.keys(oldProps);\n\n  if (accumulative) {\n    for (i = 0; i < keys.length; i++) {\n      if (newProps[keys[i]] === void 0) {\n        leftOvers.push(keys[i]);\n      }\n    }\n  }\n\n  var toFilter = [].concat(sameProps, ['children', 'key', 'ref']); // Instances use \"object\" as a reserved identifier\n\n  if (instance.__instance) toFilter.push('object');\n\n  var filteredProps = _extends__default['default']({}, newProps); // Removes sameProps and reserved props from newProps\n\n\n  keys = Object.keys(filteredProps);\n\n  for (i = 0; i < keys.length; i++) {\n    if (toFilter.indexOf(keys[i]) > -1) {\n      delete filteredProps[keys[i]];\n    }\n  } // Add left-overs as undefined props so they can be removed\n\n\n  keys = Object.keys(leftOvers);\n\n  for (i = 0; i < keys.length; i++) {\n    if (keys[i] !== 'children') {\n      filteredProps[keys[i]] = undefined;\n    }\n  }\n\n  var filteredPropsEntries = Object.entries(filteredProps);\n\n  if (filteredPropsEntries.length > 0) {\n    filteredPropsEntries.forEach(function (_ref) {\n      var key = _ref[0],\n          value = _ref[1];\n\n      if (!handlers.includes(key)) {\n        var _instance$__container, _instance$__container2;\n\n        var root = instance;\n        var target = root[key];\n\n        if (key.includes('-')) {\n          var entries = key.split('-');\n          target = entries.reduce(function (acc, key) {\n            return acc[key];\n          }, instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            var _entries$reverse = entries.reverse(),\n                _name = _entries$reverse[0],\n                reverseEntries = _entries$reverse.slice(1);\n\n            root = reverseEntries.reverse().reduce(function (acc, key) {\n              return acc[key];\n            }, instance);\n            key = _name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        var isColorManagement = (_instance$__container = instance.__container) == null ? void 0 : (_instance$__container2 = _instance$__container.__state) == null ? void 0 : _instance$__container2.current.colorManagement;\n\n        if (target && target.set && (target.copy || target instanceof THREE.Layers)) {\n          // If value is an array it has got to be the set function\n          if (Array.isArray(value)) {\n            var _target;\n\n            (_target = target).set.apply(_target, value);\n          } // Test again target.copy(class) next ...\n          else if (target.copy && value && value.constructor && target.constructor.name === value.constructor.name) {\n              target.copy(value);\n            } // If nothing else fits, just set the single value, ignore undefined\n            // https://github.com/react-spring/react-three-fiber/issues/274\n            else if (value !== undefined) {\n                target.set(value); // Auto-convert sRGB colors, for now ...\n                // https://github.com/react-spring/react-three-fiber/issues/344\n\n                if (isColorManagement && target instanceof THREE.Color) {\n                  target.convertSRGBToLinear();\n                }\n              } // Else, just overwrite the value\n\n        } else {\n          root[key] = value; // Auto-convert sRGB textures, for now ...\n          // https://github.com/react-spring/react-three-fiber/issues/344\n\n          if (isColorManagement && root[key] instanceof THREE.Texture) {\n            root[key].encoding = THREE.sRGBEncoding;\n          }\n        }\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      var index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      if (accumulative && container && instance.raycast) container.__interaction.push(instance); // Add handlers to the instances handler-map\n\n      instance.__handlers = handlers.reduce(function (acc, key) {\n        acc[key.charAt(2).toLowerCase() + key.substr(3)] = newProps[key];\n        return acc;\n      }, {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.onUpdate) instance.onUpdate(instance);\n}\n\nfunction createInstance(type, _ref2, container, hostContext, internalInstanceHandle) {\n  var _ref2$args = _ref2.args,\n      args = _ref2$args === void 0 ? [] : _ref2$args,\n      props = _objectWithoutPropertiesLoose__default['default'](_ref2, [\"args\"]);\n\n  var name = \"\" + type[0].toUpperCase() + type.slice(1);\n  var instance;\n\n  if (type === 'primitive') {\n    // Switch off dispose for primitive objects\n    props = _extends__default['default']({\n      dispose: null\n    }, props);\n    instance = props.object;\n    instance.__instance = true;\n    instance.__dispose = instance.dispose;\n  } else {\n    var target = catalogue[name] || THREE__namespace[name];\n\n    if (!target) {\n      throw \"\\\"\" + name + \"\\\" is not part of the THREE namespace! Did you forget to extend it? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively\";\n    }\n\n    instance = is.arr(args) ? _construct__default['default'](target, args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    var fn = function fn(node) {\n      if (!node[\"return\"]) return node.stateNode && node.stateNode.containerInfo;else return fn(node[\"return\"]);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // Auto-attach geometries and materials\n\n  if (name.endsWith('Geometry')) {\n    props = _extends__default['default']({\n      attach: 'geometry'\n    }, props);\n  } else if (name.endsWith('Material')) {\n    props = _extends__default['default']({\n      attach: 'material'\n    }, props);\n  } // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"true\" here\n\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.add(child);\n    } else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      } else if (child.attach) {\n        parentInstance[child.attach] = child;\n      }\n    }\n\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      });\n      var restSiblings = parentInstance.children.filter(function (sibling) {\n        return sibling !== child;\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      var index = restSiblings.indexOf(beforeChild);\n      parentInstance.children = [].concat(restSiblings.slice(0, index), [child], restSiblings.slice(index));\n      updateInstance(child);\n    } else {\n      appendChild(parentInstance, child);\n    } // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone) {\n  if (clone === void 0) {\n    clone = false;\n  }\n\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    var target = clone ? [].concat(array) : array;\n    target.forEach(function (child) {\n      return removeChild(parent, child);\n    });\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      if (parentInstance.__objects) parentInstance.__objects = parentInstance.__objects.filter(function (x) {\n        return x !== child;\n      }); // Remove attachment\n\n      if (child.attachArray) {\n        parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(function (x) {\n          return x !== child;\n        });\n      } else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      } else if (child.attach) {\n        parentInstance[child.attach] = null;\n      }\n    } // Remove interactivity\n\n\n    if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(function (x) {\n      return x !== child;\n    });\n    invalidateInstance(child); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n\n    if (child.dispose !== null) {\n      scheduler.unstable_runWithPriority(scheduler.unstable_IdlePriority, function () {\n        // Remove nested child objects\n        removeRecursive(child.__objects, child);\n        removeRecursive(child.children, child, true); // Dispose item\n\n        if (child.dispose && child.type !== 'Scene') child.dispose();else if (child.__dispose) child.__dispose(); // Remove references\n\n        delete child.__container;\n        delete child.__objects;\n      });\n    }\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  var parent = instance.parent;\n  var newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(function (fiber) {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (is.fun(fiber.ref)) fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nvar Renderer = Reconciler__default['default']({\n  now: scheduler.unstable_now,\n  createInstance: createInstance,\n  removeChild: removeChild,\n  appendChild: appendChild,\n  insertBefore: insertBefore,\n  warnsIfNotActing: true,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  // @ts-ignore\n  setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  // @ts-ignore\n  clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  noTimeout: -1,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n  commitUpdate: function commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      var _newProps$args = newProps.args,\n          argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n          restNew = _objectWithoutPropertiesLoose__default['default'](newProps, [\"args\"]);\n\n      var _oldProps$args = oldProps.args,\n          argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n          restOld = _objectWithoutPropertiesLoose__default['default'](oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      var hasNewArgs = argsNew.some(function (value, index) {\n        return is.obj(value) ? Object.entries(value).some(function (_ref3) {\n          var key = _ref3[0],\n              val = _ref3[1];\n          return val !== argsOld[index][key];\n        }) : value !== argsOld[index];\n      });\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n  hideInstance: function hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n  unhideInstance: function unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n  hideTextInstance: function hideTextInstance() {\n    throw new Error('Text is not allowed in the react-three-fibre tree. You may have extraneous whitespace between components.');\n  },\n  getPublicInstance: function getPublicInstance(instance) {\n    return instance;\n  },\n  getRootHostContext: function getRootHostContext() {\n    return emptyObject;\n  },\n  getChildHostContext: function getChildHostContext() {\n    return emptyObject;\n  },\n  createTextInstance: function createTextInstance() {},\n  finalizeInitialChildren: function finalizeInitialChildren(instance) {\n    // https://github.com/facebook/react/issues/20271\n    // Returning true will trigger commitMount\n    return instance.__handlers;\n  },\n  commitMount: function commitMount(instance)\n  /*, type, props*/\n  {\n    // https://github.com/facebook/react/issues/20271\n    // This will make sure events are only added once to the central container\n    var container = instance.__container;\n    if (container && instance.raycast && instance.__handlers) container.__interaction.push(instance);\n  },\n  prepareUpdate: function prepareUpdate() {\n    return emptyObject;\n  },\n  shouldDeprioritizeSubtree: function shouldDeprioritizeSubtree() {\n    return false;\n  },\n  prepareForCommit: function prepareForCommit() {\n    return null;\n  },\n  preparePortalMount: function preparePortalMount() {\n    return null;\n  },\n  resetAfterCommit: function resetAfterCommit() {},\n  shouldSetTextContent: function shouldSetTextContent() {\n    return false;\n  },\n  clearContainer: function clearContainer() {\n    return false;\n  }\n});\nvar hasSymbol = is.fun(Symbol) && Symbol[\"for\"];\nvar REACT_PORTAL_TYPE = hasSymbol ? Symbol[\"for\"]('react.portal') : 0xeaca;\n\nfunction render(element, container, state) {\n  var root = roots.get(container);\n\n  if (!root) {\n    container.__state = state; // @ts-ignore\n\n    var newRoot = root = Renderer.createContainer(container, state !== undefined && state.current.concurrent ? 2 : 0, false, // @ts-ignore\n    null);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, function () {\n    return undefined;\n  });\n  return Renderer.getPublicRootInstance(root);\n}\n\nfunction unmountComponentAtNode(container, callback) {\n  var root = roots.get(container);\n\n  if (root) {\n    Renderer.updateContainer(null, root, null, function () {\n      roots[\"delete\"](container);\n      if (callback) callback(container);\n    });\n  }\n}\n\nfunction createPortal(children, containerInfo, implementation, key) {\n  if (key === void 0) {\n    key = null;\n  }\n\n  if (!containerInfo.__objects) containerInfo.__objects = [];\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children: children,\n    containerInfo: containerInfo,\n    implementation: implementation\n  };\n}\n\nRenderer.injectIntoDevTools({\n  bundleType: false ? 0 : 1,\n  //@ts-ignore\n  findHostInstanceByFiber: function findHostInstanceByFiber() {\n    return null;\n  },\n  version: version,\n  rendererPackageName: name\n});\nvar threeTypes = /*#__PURE__*/Object.freeze({\n  __proto__: null\n});\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) {\n  var it;\n\n  if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      return function () {\n        if (i >= o.length) return {\n          done: true\n        };\n        return {\n          done: false,\n          value: o[i++]\n        };\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  it = o[Symbol.iterator]();\n  return it.next.bind(it);\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nvar stateContext = /*#__PURE__*/React.createContext({});\n\nvar useCanvas = function useCanvas(props) {\n  var children = props.children,\n      gl = props.gl,\n      camera = props.camera,\n      orthographic = props.orthographic,\n      raycaster = props.raycaster,\n      size = props.size,\n      pixelRatio = props.pixelRatio,\n      _props$vr = props.vr,\n      vr = _props$vr === void 0 ? false : _props$vr,\n      _props$concurrent = props.concurrent,\n      concurrent = _props$concurrent === void 0 ? false : _props$concurrent,\n      _props$shadowMap = props.shadowMap,\n      shadowMap = _props$shadowMap === void 0 ? false : _props$shadowMap,\n      _props$colorManagemen = props.colorManagement,\n      colorManagement = _props$colorManagemen === void 0 ? true : _props$colorManagemen,\n      _props$invalidateFram = props.invalidateFrameloop,\n      invalidateFrameloop = _props$invalidateFram === void 0 ? false : _props$invalidateFram,\n      _props$updateDefaultC = props.updateDefaultCamera,\n      updateDefaultCamera = _props$updateDefaultC === void 0 ? true : _props$updateDefaultC,\n      _props$noEvents = props.noEvents,\n      noEvents = _props$noEvents === void 0 ? false : _props$noEvents,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed,\n      forceResize = props.forceResize; // Local, reactive state\n\n  var _React$useState = React.useState(false),\n      ready = _React$useState[0],\n      setReady = _React$useState[1];\n\n  var _React$useState2 = React.useState(function () {\n    return new THREE.Vector2();\n  }),\n      mouse = _React$useState2[0];\n\n  var _React$useState3 = React.useState(function () {\n    var ray = new THREE.Raycaster();\n\n    if (raycaster) {\n      var filter = raycaster.filter,\n          computeOffsets = raycaster.computeOffsets,\n          raycasterProps = _objectWithoutPropertiesLoose__default['default'](raycaster, [\"filter\", \"computeOffsets\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  }),\n      defaultRaycaster = _React$useState3[0];\n\n  var _React$useState4 = React.useState(function () {\n    var scene = new THREE.Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  }),\n      defaultScene = _React$useState4[0];\n\n  var _React$useState5 = React.useState(function () {\n    var cam = orthographic ? new THREE.OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new THREE.PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {}); // Always look at [0, 0, 0]\n\n    cam.lookAt(0, 0, 0);\n    return cam;\n  }),\n      defaultCam = _React$useState5[0],\n      _setDefaultCamera = _React$useState5[1];\n\n  var _React$useState6 = React.useState(function () {\n    return new THREE.Clock();\n  }),\n      clock = _React$useState6[0]; // Public state\n\n\n  var state = React.useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    colorManagement: colorManagement,\n    vr: vr,\n    concurrent: concurrent,\n    noEvents: noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse: mouse,\n    clock: clock,\n    gl: gl,\n    size: size,\n    viewport: null,\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new tinyEmitter.TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: function subscribe(ref, priority) {\n      if (priority === void 0) {\n        priority = 0;\n      } // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n\n\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref: ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort(function (a, b) {\n        return a.priority - b.priority;\n      });\n      return function () {\n        var _state$current;\n\n        if ((_state$current = state.current) == null ? void 0 : _state$current.subscribers) {\n          // Decrease manual flag if this subscription had a priority\n          if (priority) state.current.manual--;\n          state.current.subscribers = state.current.subscribers.filter(function (s) {\n            return s.ref !== ref;\n          });\n        }\n      };\n    },\n    setDefaultCamera: function setDefaultCamera(camera) {\n      return _setDefaultCamera(camera);\n    },\n    invalidate: function invalidate$1() {\n      return invalidate(state);\n    },\n    intersect: function intersect(event, prepare) {\n      if (event === void 0) {\n        event = {};\n      }\n\n      if (prepare === void 0) {\n        prepare = true;\n      }\n\n      return handlePointerMove(event, prepare);\n    },\n    forceResize: forceResize\n  });\n  var position = new THREE.Vector3();\n  var getCurrentViewport = React.useCallback(function (camera, target) {\n    if (camera === void 0) {\n      camera = state.current.camera;\n    }\n\n    if (target === void 0) {\n      target = new THREE.Vector3(0, 0, 0);\n    }\n\n    var _state$current$size = state.current.size,\n        width = _state$current$size.width,\n        height = _state$current$size.height;\n    var distance = camera.getWorldPosition(position).distanceTo(target);\n\n    if (isOrthographicCamera(camera)) {\n      return {\n        width: width / camera.zoom,\n        height: height / camera.zoom,\n        factor: 1,\n        distance: distance\n      };\n    } else {\n      var fov = camera.fov * Math.PI / 180; // convert vertical fov to radians\n\n      var h = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      var w = h * (width / height);\n      return {\n        width: w,\n        height: h,\n        factor: width / w,\n        distance: distance\n      };\n    }\n  }, []); // Writes locals into public state for distribution among subscribers, context, etc\n\n  React.useMemo(function () {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.concurrent = concurrent;\n    state.current.noEvents = noEvents; // Make viewport backwards compatible\n\n    state.current.viewport = getCurrentViewport; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [invalidateFrameloop, vr, concurrent, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  React.useMemo(function () {\n    state.current.aspect = size.width / size.height; // Assign viewport props to the function\n\n    Object.assign(state.current.viewport, getCurrentViewport()); // https://github.com/drcmda/react-three-fiber/issues/92\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [defaultCam, gl, size, updateDefaultCamera, ready]); // Only trigger the context provider when necessary\n\n  var sharedState = React.useRef(null);\n  React.useMemo(function () {\n    var _state$current2 = state.current,\n        ready = _state$current2.ready,\n        manual = _state$current2.manual,\n        vr = _state$current2.vr,\n        noEvents = _state$current2.noEvents,\n        invalidateFrameloop = _state$current2.invalidateFrameloop,\n        frames = _state$current2.frames,\n        subscribers = _state$current2.subscribers,\n        captured = _state$current2.captured,\n        initialClick = _state$current2.initialClick,\n        initialHits = _state$current2.initialHits,\n        props = _objectWithoutPropertiesLoose__default['default'](_state$current2, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [size, defaultCam]); // Update pixel ratio\n\n  React.useLayoutEffect(function () {\n    if (pixelRatio) {\n      if (Array.isArray(pixelRatio)) gl.setPixelRatio(Math.max(Math.min(pixelRatio[0], window.devicePixelRatio), pixelRatio[1]));else gl.setPixelRatio(pixelRatio);\n    }\n  }, [gl, pixelRatio]); // Update shadow map\n\n  React.useLayoutEffect(function () {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl.shadowMap, shadowMap);else gl.shadowMap.type = THREE.PCFSoftShadowMap;\n    }\n\n    if (colorManagement) {\n      gl.toneMapping = THREE.ACESFilmicToneMapping;\n      gl.outputEncoding = THREE.sRGBEncoding;\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [shadowMap, colorManagement]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  var hovered = React.useMemo(function () {\n    return new Map();\n  }, []);\n  var temp = new THREE.Vector3();\n  /** Sets up defaultRaycaster */\n\n  var prepareRay = React.useCallback(function (event) {\n    // https://github.com/pmndrs/react-three-fiber/pull/782\n    // Events trigger outside of canvas when moved\n    var offsets = (raycaster == null ? void 0 : raycaster.computeOffsets == null ? void 0 : raycaster.computeOffsets(event, sharedState.current)) || event.nativeEvent;\n\n    if (offsets) {\n      var offsetX = offsets.offsetX,\n          offsetY = offsets.offsetY;\n      var _state$current$size2 = state.current.size,\n          width = _state$current$size2.width,\n          height = _state$current$size2.height;\n      mouse.set(offsetX / width * 2 - 1, -(offsetY / height) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  var intersect = React.useCallback(function (filter) {\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    var seen = new Set();\n    var hits = []; // Allow callers to eliminate event objects\n\n    var eventsObjects = filter ? filter(state.current.scene.__interaction) : state.current.scene.__interaction; // Intersect known handler objects and filter against duplicates\n\n    var intersects = defaultRaycaster.intersectObjects(eventsObjects, true).filter(function (item) {\n      var id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // https://github.com/mrdoob/three.js/issues/16031\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) {\n      intersects = raycaster.filter(intersects, sharedState.current);\n    }\n\n    for (var _iterator = _createForOfIteratorHelperLoose(intersects), _step; !(_step = _iterator()).done;) {\n      var _intersect = _step.value;\n      var eventObject = _intersect.object; // Bubble event up\n\n      while (eventObject) {\n        var handlers = eventObject.__handlers;\n        if (handlers) hits.push(_extends__default['default']({}, _intersect, {\n          eventObject: eventObject\n        }));\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  /**  Calculates click deltas */\n\n  var calculateDistance = React.useCallback(function (event) {\n    var dx = event.nativeEvent.offsetX - state.current.initialClick[0];\n    var dy = event.nativeEvent.offsetY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  var handlePointerCancel = React.useCallback(function (event, hits, prepare) {\n    if (prepare === void 0) {\n      prepare = true;\n    }\n\n    state.current.pointer.emit('pointerCancel', event);\n    if (prepare) prepareRay(event);\n    Array.from(hovered.values()).forEach(function (hoveredObj) {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(function (hit) {\n        return hit.object === hoveredObj.object && hit.index === hoveredObj.index;\n      }))) {\n        var eventObject = hoveredObj.eventObject;\n        var handlers = eventObject.__handlers;\n        hovered[\"delete\"](makeId(hoveredObj));\n\n        if (handlers) {\n          // Clear out intersects, they are outdated by now\n          var data = _extends__default['default']({}, hoveredObj, {\n            intersections: hits || []\n          });\n\n          if (handlers.pointerOut) handlers.pointerOut(_extends__default['default']({}, data, {\n            type: 'pointerout'\n          }));\n          if (handlers.pointerLeave) handlers.pointerLeave(_extends__default['default']({}, data, {\n            type: 'pointerleave'\n          }));\n        }\n      }\n    }); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  /**  Creates filtered intersects and returns an array of positive hits */\n\n  var getIntersects = React.useCallback(function (event, filter) {\n    // Get fresh intersects\n    var intersections = intersect(filter); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(function (captured) {\n        if (!intersections.find(function (hit) {\n          return hit.eventObject === captured.eventObject;\n        })) intersections.push(captured);\n      });\n    }\n\n    return intersections;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  var handleIntersects = React.useCallback(function (intersections, event, fn) {\n    // If anything has been found, forward it to the event listeners\n    if (intersections.length) {\n      (function () {\n        var unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(state.current.camera);\n        var delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n        var releasePointerCapture = function releasePointerCapture(id) {\n          return event.target.releasePointerCapture(id);\n        };\n\n        var localState = {\n          stopped: false,\n          captured: false\n        };\n\n        var _loop = function _loop() {\n          var hit = _step2.value;\n\n          var setPointerCapture = function setPointerCapture(id) {\n            // If the hit is going to be captured flag that we're in captured state\n            if (!localState.captured) {\n              localState.captured = true; // The captured hit array is reset to collect hits\n\n              state.current.captured = [];\n            } // Push hits to the array\n\n\n            if (state.current.captured) {\n              state.current.captured.push(hit);\n            } // Call the original event now\n\n\n            event.target.setPointerCapture(id);\n          };\n\n          var raycastEvent = _extends__default['default']({}, event, hit, {\n            intersections: intersections,\n            stopped: localState.stopped,\n            delta: delta,\n            unprojectedPoint: unprojectedPoint,\n            ray: defaultRaycaster.ray,\n            camera: state.current.camera,\n            // Hijack stopPropagation, which just sets a flag\n            stopPropagation: function stopPropagation() {\n              // https://github.com/react-spring/react-three-fiber/issues/596\n              // Events are not allowed to stop propagation if the pointer has been captured\n              var cap = state.current.captured;\n\n              if (!cap || cap.find(function (h) {\n                return h.eventObject.id === hit.eventObject.id;\n              })) {\n                raycastEvent.stopped = localState.stopped = true; // Propagation is stopped, remove all other hover records\n                // An event handler is only allowed to flush other handlers if it is hovered itself\n\n                if (hovered.size && Array.from(hovered.values()).find(function (i) {\n                  return i.eventObject === hit.eventObject;\n                })) {\n                  // Objects cannot flush out higher up objects that have already caught the event\n                  var higher = intersections.slice(0, intersections.indexOf(hit));\n                  handlePointerCancel(raycastEvent, [].concat(higher, [hit]));\n                }\n              }\n            },\n            target: _extends__default['default']({}, event.target, {\n              setPointerCapture: setPointerCapture,\n              releasePointerCapture: releasePointerCapture\n            }),\n            currentTarget: _extends__default['default']({}, event.currentTarget, {\n              setPointerCapture: setPointerCapture,\n              releasePointerCapture: releasePointerCapture\n            }),\n            sourceEvent: event\n          });\n\n          fn(raycastEvent); // Event bubbling may be interrupted by stopPropagation\n\n          if (localState.stopped === true) return \"break\";\n        };\n\n        for (var _iterator2 = _createForOfIteratorHelperLoose(intersections), _step2; !(_step2 = _iterator2()).done;) {\n          var _ret = _loop();\n\n          if (_ret === \"break\") break;\n        }\n      })();\n    }\n\n    return intersections;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  var handlePointerMove = React.useCallback(function (event, prepare) {\n    if (prepare === void 0) {\n      prepare = true;\n    }\n\n    state.current.pointer.emit('pointerMove', event);\n    if (prepare) prepareRay(event);\n    var hits = getIntersects(event, // This is onPointerMove, we're only interested in events that exhibit this particular event\n    function (objects) {\n      return objects.filter(function (obj) {\n        return ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(function (name) {\n          return obj.__handlers['pointer' + name];\n        });\n      });\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    handleIntersects(hits, event, function (data) {\n      var eventObject = data.eventObject;\n      var handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        var id = makeId(data);\n        var hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends__default['default']({}, data, {\n            type: 'pointerover'\n          }));\n          if (handlers.pointerEnter) handlers.pointerEnter(_extends__default['default']({}, data, {\n            type: 'pointerenter'\n          }));\n        } else if (hoveredItem.stopped) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      } // Call mouse move\n\n\n      if (handlers.pointerMove) handlers.pointerMove(data);\n    });\n    return hits; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  var handlePointer = React.useCallback(function (name) {\n    return function (event, prepare) {\n      if (prepare === void 0) {\n        prepare = true;\n      }\n\n      state.current.pointer.emit(name, event);\n      if (prepare) prepareRay(event);\n      var hits = getIntersects(event);\n      handleIntersects(hits, event, function (data) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers && handlers[name]) {\n          // Forward all events back to their respective handlers with the exception of click events,\n          // which must use the initial target\n          if (name !== 'click' && name !== 'contextMenu' && name !== 'doubleClick' || state.current.initialHits.includes(eventObject)) {\n            handlers[name](data);\n            pointerMissed(event, defaultScene.__interaction, function (object) {\n              return object !== eventObject;\n            });\n          }\n        }\n      }); // If a click yields no results, pass it back to the user as a miss\n\n      if (name === 'pointerDown') {\n        state.current.initialClick = [event.nativeEvent.offsetX, event.nativeEvent.offsetY];\n        state.current.initialHits = hits.map(function (hit) {\n          return hit.eventObject;\n        });\n      }\n\n      if ((name === 'click' || name === 'contextMenu' || name === 'doubleClick') && !hits.length) {\n        if (calculateDistance(event) <= 2) {\n          pointerMissed(event, defaultScene.__interaction);\n          if (onPointerMissed) onPointerMissed();\n        }\n      }\n    };\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [onPointerMissed, calculateDistance, getIntersects, handleIntersects, prepareRay]);\n  React.useMemo(function () {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onContextMenu: handlePointer('contextMenu'),\n      onDoubleClick: handlePointer('doubleClick'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: function onPointerLeave(e) {\n        return handlePointerCancel(e, []);\n      },\n      onPointerMove: handlePointerMove,\n      // onGotPointerCapture is not needed any longer because the behaviour is hacked into\n      // the event itself (see handleIntersects). But in order for non-web targets to simulate\n      // it we keep the legacy event, which simply flags all current intersects as captured\n      onGotPointerCaptureLegacy: function onGotPointerCaptureLegacy(e) {\n        return state.current.captured = intersect();\n      },\n      onLostPointerCapture: function onLostPointerCapture(e) {\n        return state.current.captured = undefined, handlePointerCancel(e);\n      }\n    };\n  }, [handlePointer, intersect, handlePointerCancel, handlePointerMove]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // This component is a bridge into the three render context, when it gets rendered\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  var Canvas = React.useCallback(function Canvas(props) {\n    var activate = function activate() {\n      return setReady(true);\n    }; // Pre-compile all materials before rendering out the first time\n\n\n    React.useLayoutEffect(function () {\n      return void gl.compile(defaultScene, defaultCam);\n    }, []);\n    React.useEffect(function () {\n      var result = onCreated && onCreated(state.current);\n      if (result && result.then) result.then(activate);else activate();\n    }, []);\n    return props.children;\n  }, // The Canvas component has to be static, it should not be re-created ever\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  []); // Render v-dom into scene\n\n  React.useLayoutEffect(function () {\n    render( /*#__PURE__*/React.createElement(Canvas, null, /*#__PURE__*/React.createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children)), defaultScene, state); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ready, children, sharedState.current]);\n  React.useLayoutEffect(function () {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        if (state.current.frames === 0) invalidate(state);\n      } else if ((gl.xr || gl.vr) && gl.setAnimationLoop) {\n        (gl.xr || gl.vr).enabled = true;\n        gl.setAnimationLoop(function (t) {\n          return renderGl(state, t, 0, true);\n        });\n      } else {\n        console.warn('the gl instance does not support VR!');\n      }\n    }\n  }, [gl, ready, invalidateFrameloop]); // Dispose renderer on unmount\n\n  React.useEffect(function () {\n    return function () {\n      if (state.current.gl) {\n        if (state.current.gl.renderLists) state.current.gl.renderLists.dispose();\n        if (state.current.gl.forceContextLoss) state.current.gl.forceContextLoss();\n        dispose(state.current.gl);\n      }\n\n      unmountComponentAtNode(state.current.scene, function () {\n        dispose(state.current.raycaster);\n        dispose(state.current.camera);\n        dispose(state.current);\n      });\n    };\n  }, []);\n  return state.current.events;\n};\n\nfunction pointerMissed(event, objects, filter) {\n  if (filter === void 0) {\n    filter = function filter(object) {\n      return true;\n    };\n  }\n\n  objects.filter(filter).forEach(function (object) {\n    var _handlers$pointerMis, _handlers;\n\n    return (_handlers$pointerMis = (_handlers = object.__handlers).pointerMissed) == null ? void 0 : _handlers$pointerMis.call(_handlers, event);\n  });\n}\n\nfunction dispose(obj) {\n  if (obj.dispose && obj.type !== 'Scene') obj.dispose();\n\n  for (var p in obj) {\n    if (typeof p === 'object' && p.dispose) p.dispose();\n    delete obj[p];\n  }\n}\n\nfunction useContext(context) {\n  var result = React.useContext(context);\n\n  if (!('subscribe' in result)) {\n    throw new Error(\"\\u26A1\\uFE0F react-three-fiber hooks can only be used within the Canvas component! https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#hooks\");\n  }\n\n  return result;\n}\n\nfunction useFrame(callback, renderPriority) {\n  if (renderPriority === void 0) {\n    renderPriority = 0;\n  }\n\n  var _useContext = useContext(stateContext),\n      subscribe = _useContext.subscribe; // Update ref\n\n\n  var ref = React.useRef(callback);\n  React.useLayoutEffect(function () {\n    return void (ref.current = callback);\n  }, [callback]); // Subscribe/unsub\n\n  React.useEffect(function () {\n    var unsubscribe = subscribe(ref, renderPriority);\n    return function () {\n      return unsubscribe();\n    };\n  }, [renderPriority, subscribe]);\n  return null;\n}\n\nfunction useThree() {\n  return useContext(stateContext);\n}\n\nfunction useUpdate(callback, dependents, optionalRef) {\n  var _useContext2 = useContext(stateContext),\n      invalidate = _useContext2.invalidate;\n\n  var localRef = React.useRef();\n  var ref = optionalRef ? optionalRef : localRef;\n  React.useLayoutEffect(function () {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return ref;\n}\n\nfunction useResource(optionalRef) {\n  var _useState = React.useState(false),\n      _ = _useState[0],\n      forceUpdate = _useState[1];\n\n  var localRef = React.useRef(undefined);\n  var ref = optionalRef ? optionalRef : localRef;\n  React.useLayoutEffect(function () {\n    return void forceUpdate(function (i) {\n      return !i;\n    });\n  }, []);\n  return ref;\n}\n\nfunction buildGraph(object) {\n  var data = {\n    nodes: {},\n    materials: {}\n  };\n\n  if (object) {\n    object.traverse(function (obj) {\n      if (obj.name) data.nodes[obj.name] = obj;\n      if (obj.material && !data.materials[obj.material.name]) data.materials[obj.material.name] = obj.material;\n    });\n  }\n\n  return data;\n}\n\nfunction useGraph(object) {\n  return React.useMemo(function () {\n    return buildGraph(object);\n  }, [object]);\n}\n\nfunction loadingFn(extensions, onProgress) {\n  return function (Proto) {\n    // Construct new loader and run extensions\n    var loader = new Proto();\n    if (extensions) extensions(loader); // Go through the urls and load them\n\n    for (var _len = arguments.length, input = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      input[_key - 1] = arguments[_key];\n    }\n\n    return Promise.all(input.map(function (input) {\n      return new Promise(function (res, reject) {\n        return loader.load(input, function (data) {\n          if (data.scene) Object.assign(data, buildGraph(data.scene));\n          res(data);\n        }, onProgress, function (error) {\n          var _error$message;\n\n          return reject((_error$message = error.message) != null ? _error$message : \"failure loading \" + input);\n        });\n      });\n    }));\n  };\n}\n\nfunction useLoader(Proto, input, extensions, onProgress) {\n  // Use suspense to load async assets\n  var keys = Array.isArray(input) ? input : [input];\n  var results = useAsset.useAsset.apply(void 0, [loadingFn(extensions, onProgress), Proto].concat(keys)); // Return the object/s\n\n  return Array.isArray(input) ? results : results[0];\n}\n\nuseLoader.preload = function (Proto, input, extensions) {\n  var keys = Array.isArray(input) ? input : [input];\n  return useAsset.useAsset.preload.apply(useAsset.useAsset, [loadingFn(extensions), Proto].concat(keys));\n};\n\nvar defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\n\nfunction Content(_ref) {\n  var children = _ref.children,\n      setEvents = _ref.setEvents,\n      container = _ref.container,\n      renderer = _ref.renderer,\n      effects = _ref.effects,\n      props = _objectWithoutPropertiesLoose__default['default'](_ref, [\"children\", \"setEvents\", \"container\", \"renderer\", \"effects\"]); // Create renderer\n\n\n  var _useState = React.useState(renderer),\n      gl = _useState[0];\n\n  if (!gl) console.warn('No renderer created!'); // Mount and unmount management\n\n  React.useEffect(function () {\n    if (effects) effects(gl, container);\n  }, [container, effects, gl]); // Init canvas, fetch events, hand them back to the wrapping div\n\n  var events = useCanvas(_extends__default['default']({}, props, {\n    children: children,\n    gl: gl\n  }));\n  React.useEffect(function () {\n    setEvents(events);\n  }, [events, setEvents]);\n  return null;\n}\n\nvar ResizeContainer = /*#__PURE__*/React__default['default'].memo(function ResizeContainer(props) {\n  var renderer = props.renderer,\n      effects = props.effects,\n      children = props.children,\n      vr = props.vr,\n      webgl1 = props.webgl1,\n      concurrent = props.concurrent,\n      shadowMap = props.shadowMap,\n      colorManagement = props.colorManagement,\n      orthographic = props.orthographic,\n      invalidateFrameloop = props.invalidateFrameloop,\n      updateDefaultCamera = props.updateDefaultCamera,\n      noEvents = props.noEvents,\n      gl = props.gl,\n      camera = props.camera,\n      raycaster = props.raycaster,\n      pixelRatio = props.pixelRatio,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed,\n      preRender = props.preRender,\n      resize = props.resize,\n      style = props.style,\n      restSpread = _objectWithoutPropertiesLoose__default['default'](props, [\"renderer\", \"effects\", \"children\", \"vr\", \"webgl1\", \"concurrent\", \"shadowMap\", \"colorManagement\", \"orthographic\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"onCreated\", \"onPointerMissed\", \"preRender\", \"resize\", \"style\"]);\n\n  var containerRef = React.useRef(); // onGotPointerCaptureLegacy is a fake event used by non-web targets to simulate poinzter capture\n\n  var _useState2 = React.useState({}),\n      _useState2$ = _useState2[0],\n      onGotPointerCaptureLegacy = _useState2$.onGotPointerCaptureLegacy,\n      events = _objectWithoutPropertiesLoose__default['default'](_useState2$, [\"onGotPointerCaptureLegacy\"]),\n      setEvents = _useState2[1];\n\n  var _useMeasure = useMeasure__default['default'](_extends__default['default']({\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    }\n  }, resize)),\n      bind = _useMeasure[0],\n      size = _useMeasure[1],\n      forceResize = _useMeasure[2]; // Flag view ready once it's been measured out\n\n\n  var readyFlag = React.useRef(false);\n  var ready = React.useMemo(function () {\n    return readyFlag.current = readyFlag.current || !!size.width && !!size.height;\n  }, [size]);\n  var state = React.useMemo(function () {\n    return {\n      size: size,\n      forceResize: forceResize,\n      setEvents: setEvents,\n      container: containerRef.current\n    };\n  }, [forceResize, size]); // Allow Gatsby, Next and other server side apps to run. Will output styles to reduce flickering.\n\n  if (true) return /*#__PURE__*/React__default['default'].createElement(\"div\", _extends__default['default']({\n    style: _extends__default['default']({}, defaultStyles, style)\n  }, restSpread), preRender); // Render the canvas into the dom\n\n  return /*#__PURE__*/React__default['default'].createElement(\"div\", _extends__default['default']({\n    ref: mergeRefs__default['default']([bind, containerRef]),\n    style: _extends__default['default']({}, defaultStyles, style)\n  }, events, restSpread), preRender, ready && /*#__PURE__*/React__default['default'].createElement(Content, _extends__default['default']({}, props, state)));\n});\nvar Canvas = /*#__PURE__*/React__default['default'].memo(function Canvas(_ref) {\n  var children = _ref.children,\n      props = _objectWithoutPropertiesLoose__default['default'](_ref, [\"children\"]);\n\n  var canvasRef = React.useRef();\n\n  var _renderer = props.webgl1 ? THREE.WebGL1Renderer : THREE.WebGLRenderer;\n\n  return /*#__PURE__*/React__default['default'].createElement(ResizeContainer, _extends__default['default']({}, props, {\n    renderer: function renderer() {\n      if (canvasRef.current) {\n        var params = _extends__default['default']({\n          antialias: true,\n          alpha: true\n        }, props.gl);\n\n        var temp = new _renderer(_extends__default['default']({\n          powerPreference: 'high-performance',\n          //stencil: false,\n          //depth: false,\n          canvas: canvasRef.current\n        }, params));\n        return temp;\n      }\n    },\n    preRender: /*#__PURE__*/React__default['default'].createElement(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'block'\n      }\n    })\n  }), children);\n});\nexports.Canvas = Canvas;\nexports.ReactThreeFiber = threeTypes;\nexports.Renderer = Renderer;\nexports.ResizeContainer = ResizeContainer;\nexports.addAfterEffect = addAfterEffect;\nexports.addEffect = addEffect;\nexports.addTail = addTail;\nexports.applyProps = applyProps;\nexports.createPortal = createPortal;\nexports.extend = extend;\nexports.forceResize = forceResize;\nexports.invalidate = invalidate;\nexports.isOrthographicCamera = isOrthographicCamera;\nexports.render = render;\nexports.renderGl = renderGl;\nexports.stateContext = stateContext;\nexports.unmountComponentAtNode = unmountComponentAtNode;\nexports.useCanvas = useCanvas;\nexports.useFrame = useFrame;\nexports.useGraph = useGraph;\nexports.useLoader = useLoader;\nexports.useResource = useResource;\nexports.useThree = useThree;\nexports.useUpdate = useUpdate;","map":{"version":3,"sources":["/Users/ikuzmin/Documents/morozov-name/node_modules/react-three-fiber/web.cjs.js"],"names":["Object","defineProperty","exports","value","_extends","require","_objectWithoutPropertiesLoose","_construct","THREE","Reconciler","scheduler","React","tinyEmitter","useAsset","useMeasure","mergeRefs","_interopDefaultLegacy","e","_interopNamespace","__esModule","n","create","keys","forEach","k","d","getOwnPropertyDescriptor","get","enumerable","freeze","_extends__default","_objectWithoutPropertiesLoose__default","_construct__default","THREE__namespace","Reconciler__default","React__default","useMeasure__default","mergeRefs__default","name","version","roots","Map","emptyObject","is","obj","a","arr","fun","str","num","und","Array","isArray","equ","b","i","createSubs","callback","subs","index","length","push","splice","globalEffects","globalAfterEffects","globalTailEffects","addEffect","addAfterEffect","addTail","renderGl","state","timestamp","repeat","runGlobalEffects","delta","current","clock","getDelta","subscribers","ref","frames","Math","max","invalidateFrameloop","manual","gl","render","scene","camera","running","renderLoop","root","containerInfo","__state","active","ready","requestAnimationFrame","invalidate","vr","forceResize","catalogue","extend","objects","applyProps","instance","newProps","oldProps","accumulative","container","__container","sameProps","handlers","startsWith","includes","leftOvers","toFilter","concat","__instance","filteredProps","indexOf","undefined","filteredPropsEntries","entries","_ref","key","_instance$__container","_instance$__container2","target","split","reduce","acc","set","_entries$reverse","reverse","_name","reverseEntries","slice","isColorManagement","colorManagement","copy","Layers","_target","apply","constructor","Color","convertSRGBToLinear","Texture","encoding","sRGBEncoding","invalidateInstance","raycast","__handlers","__interaction","charAt","toLowerCase","substr","parent","updateInstance","onUpdate","createInstance","type","_ref2","hostContext","internalInstanceHandle","_ref2$args","args","props","toUpperCase","dispose","object","__dispose","has","fn","node","stateNode","__objects","endsWith","attach","appendChild","parentInstance","child","isObject3D","add","attachArray","attachObject","insertBefore","beforeChild","dispatchEvent","restSiblings","children","filter","sibling","removeRecursive","array","clone","removeChild","remove","x","unstable_runWithPriority","unstable_IdlePriority","switchInstance","fiber","newInstance","alternate","Renderer","now","unstable_now","warnsIfNotActing","supportsMutation","isPrimaryRenderer","scheduleTimeout","setTimeout","cancelTimeout","clearTimeout","noTimeout","appendInitialChild","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","commitUpdate","updatePayload","_newProps$args","argsNew","restNew","_oldProps$args","argsOld","restOld","hasNewArgs","some","_ref3","val","hideInstance","visible","unhideInstance","hideTextInstance","Error","getPublicInstance","getRootHostContext","getChildHostContext","createTextInstance","finalizeInitialChildren","commitMount","prepareUpdate","shouldDeprioritizeSubtree","prepareForCommit","preparePortalMount","resetAfterCommit","shouldSetTextContent","clearContainer","hasSymbol","Symbol","REACT_PORTAL_TYPE","element","newRoot","createContainer","concurrent","updateContainer","getPublicRootInstance","unmountComponentAtNode","createPortal","implementation","$$typeof","injectIntoDevTools","bundleType","findHostInstanceByFiber","rendererPackageName","threeTypes","__proto__","_createForOfIteratorHelperLoose","o","allowArrayLike","it","iterator","_unsupportedIterableToArray","done","TypeError","next","bind","minLen","_arrayLikeToArray","prototype","toString","call","from","test","len","arr2","isOrthographicCamera","def","makeId","event","eventObject","uuid","stateContext","createContext","useCanvas","orthographic","raycaster","size","pixelRatio","_props$vr","_props$concurrent","_props$shadowMap","shadowMap","_props$colorManagemen","_props$invalidateFram","_props$updateDefaultC","updateDefaultCamera","_props$noEvents","noEvents","onCreated","onPointerMissed","_React$useState","useState","setReady","_React$useState2","Vector2","mouse","_React$useState3","ray","Raycaster","computeOffsets","raycasterProps","defaultRaycaster","_React$useState4","Scene","defaultScene","_React$useState5","cam","OrthographicCamera","PerspectiveCamera","position","z","lookAt","defaultCam","_setDefaultCamera","_React$useState6","Clock","useRef","aspect","viewport","initialClick","initialHits","pointer","TinyEmitter","captured","events","subscribe","priority","sort","_state$current","s","setDefaultCamera","invalidate$1","intersect","prepare","handlePointerMove","Vector3","getCurrentViewport","useCallback","_state$current$size","width","height","distance","getWorldPosition","distanceTo","zoom","factor","fov","PI","h","tan","w","useMemo","assign","left","right","top","bottom","updateProjectionMatrix","updateMatrixWorld","setSize","sharedState","_state$current2","useLayoutEffect","setPixelRatio","min","window","devicePixelRatio","enabled","PCFSoftShadowMap","toneMapping","ACESFilmicToneMapping","outputEncoding","hovered","temp","prepareRay","offsets","nativeEvent","offsetX","offsetY","_state$current$size2","setFromCamera","seen","Set","hits","eventsObjects","intersects","intersectObjects","item","id","_iterator","_step","_intersect","calculateDistance","dx","dy","round","sqrt","handlePointerCancel","emit","values","hoveredObj","find","hit","data","intersections","pointerOut","pointerLeave","getIntersects","handleIntersects","unprojectedPoint","y","unproject","releasePointerCapture","localState","stopped","_loop","_step2","setPointerCapture","raycastEvent","stopPropagation","cap","higher","currentTarget","sourceEvent","_iterator2","_ret","pointerOver","pointerEnter","hoveredItem","pointerMove","handlePointer","pointerMissed","map","onClick","onContextMenu","onDoubleClick","onWheel","onPointerDown","onPointerUp","onPointerLeave","onPointerMove","onGotPointerCaptureLegacy","onLostPointerCapture","Canvas","activate","compile","useEffect","result","then","createElement","Provider","xr","setAnimationLoop","t","console","warn","renderLists","forceContextLoss","_handlers$pointerMis","_handlers","p","useContext","context","useFrame","renderPriority","_useContext","unsubscribe","useThree","useUpdate","dependents","optionalRef","_useContext2","localRef","useResource","_useState","_","forceUpdate","buildGraph","nodes","materials","traverse","material","useGraph","loadingFn","extensions","onProgress","Proto","loader","_len","arguments","input","_key","Promise","all","res","reject","load","error","_error$message","message","useLoader","results","preload","defaultStyles","overflow","Content","setEvents","renderer","effects","ResizeContainer","memo","webgl1","preRender","resize","style","restSpread","containerRef","_useState2","_useState2$","_useMeasure","scroll","debounce","readyFlag","canvasRef","_renderer","WebGL1Renderer","WebGLRenderer","params","antialias","alpha","powerPreference","canvas","display","ReactThreeFiber"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar _extends = require('@babel/runtime/helpers/extends');\nvar _objectWithoutPropertiesLoose = require('@babel/runtime/helpers/objectWithoutPropertiesLoose');\nvar _construct = require('@babel/runtime/helpers/construct');\nvar THREE = require('three');\nvar Reconciler = require('react-reconciler');\nvar scheduler = require('scheduler');\nvar React = require('react');\nvar tinyEmitter = require('tiny-emitter');\nvar useAsset = require('use-asset');\nvar useMeasure = require('react-use-measure');\nvar mergeRefs = require('react-merge-refs');\n\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\n\nfunction _interopNamespace(e) {\n  if (e && e.__esModule) return e;\n  var n = Object.create(null);\n  if (e) {\n    Object.keys(e).forEach(function (k) {\n      if (k !== 'default') {\n        var d = Object.getOwnPropertyDescriptor(e, k);\n        Object.defineProperty(n, k, d.get ? d : {\n          enumerable: true,\n          get: function () {\n            return e[k];\n          }\n        });\n      }\n    });\n  }\n  n['default'] = e;\n  return Object.freeze(n);\n}\n\nvar _extends__default = /*#__PURE__*/_interopDefaultLegacy(_extends);\nvar _objectWithoutPropertiesLoose__default = /*#__PURE__*/_interopDefaultLegacy(_objectWithoutPropertiesLoose);\nvar _construct__default = /*#__PURE__*/_interopDefaultLegacy(_construct);\nvar THREE__namespace = /*#__PURE__*/_interopNamespace(THREE);\nvar Reconciler__default = /*#__PURE__*/_interopDefaultLegacy(Reconciler);\nvar React__default = /*#__PURE__*/_interopDefaultLegacy(React);\nvar useMeasure__default = /*#__PURE__*/_interopDefaultLegacy(useMeasure);\nvar mergeRefs__default = /*#__PURE__*/_interopDefaultLegacy(mergeRefs);\n\nvar name = \"react-three-fiber\";\nvar version = \"5.3.19\";\n\nvar roots = new Map();\nvar emptyObject = {};\nvar is = {\n  obj: function obj(a) {\n    return a === Object(a) && !is.arr(a);\n  },\n  fun: function fun(a) {\n    return typeof a === 'function';\n  },\n  str: function str(a) {\n    return typeof a === 'string';\n  },\n  num: function num(a) {\n    return typeof a === 'number';\n  },\n  und: function und(a) {\n    return a === void 0;\n  },\n  arr: function arr(a) {\n    return Array.isArray(a);\n  },\n  equ: function equ(a, b) {\n    // Wrong type or one of the two undefined, doesn't match\n    if (typeof a !== typeof b || !!a !== !!b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    var i;\n\n    for (i in a) {\n      if (!(i in b)) return false;\n    }\n\n    for (i in b) {\n      if (a[i] !== b[i]) return false;\n    }\n\n    return is.und(i) ? a === b : true;\n  }\n};\n\nfunction createSubs(callback, subs) {\n  var index = subs.length;\n  subs.push(callback);\n  return function () {\n    return void subs.splice(index, 1);\n  };\n}\n\nvar globalEffects = [];\nvar globalAfterEffects = [];\nvar globalTailEffects = [];\nvar addEffect = function addEffect(callback) {\n  return createSubs(callback, globalEffects);\n};\nvar addAfterEffect = function addAfterEffect(callback) {\n  return createSubs(callback, globalAfterEffects);\n};\nvar addTail = function addTail(callback) {\n  return createSubs(callback, globalTailEffects);\n};\nfunction renderGl(state, timestamp, repeat, runGlobalEffects) {\n  if (repeat === void 0) {\n    repeat = 0;\n  }\n\n  if (runGlobalEffects === void 0) {\n    runGlobalEffects = false;\n  }\n\n  var i; // Run global effects\n\n  if (runGlobalEffects) {\n    for (i = 0; i < globalEffects.length; i++) {\n      globalEffects[i](timestamp);\n      repeat++;\n    }\n  } // Run local effects\n\n\n  var delta = state.current.clock.getDelta();\n\n  for (i = 0; i < state.current.subscribers.length; i++) {\n    state.current.subscribers[i].ref.current(state.current, delta);\n  } // Decrease frame count\n\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual && state.current.gl.render) state.current.gl.render(state.current.scene, state.current.camera); // Run global after-effects\n\n  if (runGlobalEffects) {\n    for (i = 0; i < globalAfterEffects.length; i++) {\n      globalAfterEffects[i](timestamp);\n    }\n  }\n\n  return repeat;\n}\nvar running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  var repeat = 0;\n  var i; // Run global effects\n\n  for (i = 0; i < globalEffects.length; i++) {\n    globalEffects[i](timestamp);\n    repeat++;\n  }\n\n  roots.forEach(function (root) {\n    var state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) {\n      repeat = renderGl(state, timestamp, repeat);\n    } else {\n      repeat = 0;\n    }\n  }); // Run global after-effects\n\n  for (i = 0; i < globalAfterEffects.length; i++) {\n    globalAfterEffects[i](timestamp);\n  }\n\n  if (repeat !== 0) {\n    return requestAnimationFrame(renderLoop);\n  } else {\n    // Tail call effects, they are called when rendering stops\n    for (i = 0; i < globalTailEffects.length; i++) {\n      globalTailEffects[i](timestamp);\n    }\n  } // Flag end of operation\n\n\n  running = false;\n}\n\nfunction invalidate(state, frames) {\n  if (state === void 0) {\n    state = true;\n  }\n\n  if (frames === void 0) {\n    frames = 1;\n  }\n\n  if (state === true) {\n    roots.forEach(function (root) {\n      var state = root.containerInfo.__state;\n      state.current.frames = state.current.ready ? state.current.frames + frames : frames;\n    });\n  } else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = state.current.ready ? state.current.frames + frames : frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\nfunction forceResize() {\n  roots.forEach(function (root) {\n    return root.containerInfo.__state.current.forceResize();\n  });\n}\nvar catalogue = {};\nvar extend = function extend(objects) {\n  return void (catalogue = _extends__default['default']({}, catalogue, objects));\n};\nfunction applyProps(instance, newProps, oldProps, accumulative) {\n  if (oldProps === void 0) {\n    oldProps = {};\n  }\n\n  if (accumulative === void 0) {\n    accumulative = false;\n  }\n\n  // Filter equals, events and reserved props\n  var container = instance.__container;\n  var sameProps = [];\n  var handlers = [];\n  var i;\n  var keys = Object.keys(newProps);\n\n  for (i = 0; i < keys.length; i++) {\n    if (is.equ(newProps[keys[i]], oldProps[keys[i]])) {\n      sameProps.push(keys[i]);\n    } // Event-handlers ...\n    //   are functions, that\n    //   start with \"on\", and\n    //   contain the name \"Pointer\", \"Click\", \"ContextMenu\", or \"Wheel\"\n\n\n    if (is.fun(newProps[keys[i]]) && keys[i].startsWith('on')) {\n      if (keys[i].includes('Pointer') || keys[i].includes('Click') || keys[i].includes('ContextMenu') || keys[i].includes('Wheel')) {\n        handlers.push(keys[i]);\n      }\n    }\n  }\n\n  var leftOvers = [];\n  keys = Object.keys(oldProps);\n\n  if (accumulative) {\n    for (i = 0; i < keys.length; i++) {\n      if (newProps[keys[i]] === void 0) {\n        leftOvers.push(keys[i]);\n      }\n    }\n  }\n\n  var toFilter = [].concat(sameProps, ['children', 'key', 'ref']); // Instances use \"object\" as a reserved identifier\n\n  if (instance.__instance) toFilter.push('object');\n\n  var filteredProps = _extends__default['default']({}, newProps); // Removes sameProps and reserved props from newProps\n\n\n  keys = Object.keys(filteredProps);\n\n  for (i = 0; i < keys.length; i++) {\n    if (toFilter.indexOf(keys[i]) > -1) {\n      delete filteredProps[keys[i]];\n    }\n  } // Add left-overs as undefined props so they can be removed\n\n\n  keys = Object.keys(leftOvers);\n\n  for (i = 0; i < keys.length; i++) {\n    if (keys[i] !== 'children') {\n      filteredProps[keys[i]] = undefined;\n    }\n  }\n\n  var filteredPropsEntries = Object.entries(filteredProps);\n\n  if (filteredPropsEntries.length > 0) {\n    filteredPropsEntries.forEach(function (_ref) {\n      var key = _ref[0],\n          value = _ref[1];\n\n      if (!handlers.includes(key)) {\n        var _instance$__container, _instance$__container2;\n\n        var root = instance;\n        var target = root[key];\n\n        if (key.includes('-')) {\n          var entries = key.split('-');\n          target = entries.reduce(function (acc, key) {\n            return acc[key];\n          }, instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            var _entries$reverse = entries.reverse(),\n                _name = _entries$reverse[0],\n                reverseEntries = _entries$reverse.slice(1);\n\n            root = reverseEntries.reverse().reduce(function (acc, key) {\n              return acc[key];\n            }, instance);\n            key = _name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        var isColorManagement = (_instance$__container = instance.__container) == null ? void 0 : (_instance$__container2 = _instance$__container.__state) == null ? void 0 : _instance$__container2.current.colorManagement;\n\n        if (target && target.set && (target.copy || target instanceof THREE.Layers)) {\n          // If value is an array it has got to be the set function\n          if (Array.isArray(value)) {\n            var _target;\n\n            (_target = target).set.apply(_target, value);\n          } // Test again target.copy(class) next ...\n          else if (target.copy && value && value.constructor && target.constructor.name === value.constructor.name) {\n              target.copy(value);\n            } // If nothing else fits, just set the single value, ignore undefined\n            // https://github.com/react-spring/react-three-fiber/issues/274\n            else if (value !== undefined) {\n                target.set(value); // Auto-convert sRGB colors, for now ...\n                // https://github.com/react-spring/react-three-fiber/issues/344\n\n                if (isColorManagement && target instanceof THREE.Color) {\n                  target.convertSRGBToLinear();\n                }\n              } // Else, just overwrite the value\n\n        } else {\n          root[key] = value; // Auto-convert sRGB textures, for now ...\n          // https://github.com/react-spring/react-three-fiber/issues/344\n\n          if (isColorManagement && root[key] instanceof THREE.Texture) {\n            root[key].encoding = THREE.sRGBEncoding;\n          }\n        }\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      var index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      if (accumulative && container && instance.raycast) container.__interaction.push(instance); // Add handlers to the instances handler-map\n\n      instance.__handlers = handlers.reduce(function (acc, key) {\n        acc[key.charAt(2).toLowerCase() + key.substr(3)] = newProps[key];\n        return acc;\n      }, {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.onUpdate) instance.onUpdate(instance);\n}\n\nfunction createInstance(type, _ref2, container, hostContext, internalInstanceHandle) {\n  var _ref2$args = _ref2.args,\n      args = _ref2$args === void 0 ? [] : _ref2$args,\n      props = _objectWithoutPropertiesLoose__default['default'](_ref2, [\"args\"]);\n\n  var name = \"\" + type[0].toUpperCase() + type.slice(1);\n  var instance;\n\n  if (type === 'primitive') {\n    // Switch off dispose for primitive objects\n    props = _extends__default['default']({\n      dispose: null\n    }, props);\n    instance = props.object;\n    instance.__instance = true;\n    instance.__dispose = instance.dispose;\n  } else {\n    var target = catalogue[name] || THREE__namespace[name];\n\n    if (!target) {\n      throw \"\\\"\" + name + \"\\\" is not part of the THREE namespace! Did you forget to extend it? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively\";\n    }\n\n    instance = is.arr(args) ? _construct__default['default'](target, args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // TODO: https://github.com/facebook/react/issues/17147\n  // If it's still not there it means the portal was created on a virtual node outside of react\n\n\n  if (!roots.has(container)) {\n    var fn = function fn(node) {\n      if (!node[\"return\"]) return node.stateNode && node.stateNode.containerInfo;else return fn(node[\"return\"]);\n    };\n\n    container = fn(internalInstanceHandle);\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // Auto-attach geometries and materials\n\n  if (name.endsWith('Geometry')) {\n    props = _extends__default['default']({\n      attach: 'geometry'\n    }, props);\n  } else if (name.endsWith('Material')) {\n    props = _extends__default['default']({\n      attach: 'material'\n    }, props);\n  } // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"true\" here\n\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.add(child);\n    } else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      } else if (child.attach) {\n        parentInstance[child.attach] = child;\n      }\n    }\n\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      });\n      var restSiblings = parentInstance.children.filter(function (sibling) {\n        return sibling !== child;\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      var index = restSiblings.indexOf(beforeChild);\n      parentInstance.children = [].concat(restSiblings.slice(0, index), [child], restSiblings.slice(index));\n      updateInstance(child);\n    } else {\n      appendChild(parentInstance, child);\n    } // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone) {\n  if (clone === void 0) {\n    clone = false;\n  }\n\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    var target = clone ? [].concat(array) : array;\n    target.forEach(function (child) {\n      return removeChild(parent, child);\n    });\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      if (parentInstance.__objects) parentInstance.__objects = parentInstance.__objects.filter(function (x) {\n        return x !== child;\n      }); // Remove attachment\n\n      if (child.attachArray) {\n        parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(function (x) {\n          return x !== child;\n        });\n      } else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      } else if (child.attach) {\n        parentInstance[child.attach] = null;\n      }\n    } // Remove interactivity\n\n\n    if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(function (x) {\n      return x !== child;\n    });\n    invalidateInstance(child); // Allow objects to bail out of recursive dispose alltogether by passing dispose={null}\n\n    if (child.dispose !== null) {\n      scheduler.unstable_runWithPriority(scheduler.unstable_IdlePriority, function () {\n        // Remove nested child objects\n        removeRecursive(child.__objects, child);\n        removeRecursive(child.children, child, true); // Dispose item\n\n        if (child.dispose && child.type !== 'Scene') child.dispose();else if (child.__dispose) child.__dispose(); // Remove references\n\n        delete child.__container;\n        delete child.__objects;\n      });\n    }\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  var parent = instance.parent;\n  var newInstance = createInstance(type, newProps, instance.__container, null, fiber);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(function (fiber) {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (is.fun(fiber.ref)) fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nvar Renderer = Reconciler__default['default']({\n  now: scheduler.unstable_now,\n  createInstance: createInstance,\n  removeChild: removeChild,\n  appendChild: appendChild,\n  insertBefore: insertBefore,\n  warnsIfNotActing: true,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  scheduleTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  cancelTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  // @ts-ignore\n  setTimeout: is.fun(setTimeout) ? setTimeout : undefined,\n  // @ts-ignore\n  clearTimeout: is.fun(clearTimeout) ? clearTimeout : undefined,\n  noTimeout: -1,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n  commitUpdate: function commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else {\n      // This is a data object, let's extract critical information about it\n      var _newProps$args = newProps.args,\n          argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n          restNew = _objectWithoutPropertiesLoose__default['default'](newProps, [\"args\"]);\n\n      var _oldProps$args = oldProps.args,\n          argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n          restOld = _objectWithoutPropertiesLoose__default['default'](oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      var hasNewArgs = argsNew.some(function (value, index) {\n        return is.obj(value) ? Object.entries(value).some(function (_ref3) {\n          var key = _ref3[0],\n              val = _ref3[1];\n          return val !== argsOld[index][key];\n        }) : value !== argsOld[index];\n      });\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n  hideInstance: function hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n  unhideInstance: function unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n  hideTextInstance: function hideTextInstance() {\n    throw new Error('Text is not allowed in the react-three-fibre tree. You may have extraneous whitespace between components.');\n  },\n  getPublicInstance: function getPublicInstance(instance) {\n    return instance;\n  },\n  getRootHostContext: function getRootHostContext() {\n    return emptyObject;\n  },\n  getChildHostContext: function getChildHostContext() {\n    return emptyObject;\n  },\n  createTextInstance: function createTextInstance() {},\n  finalizeInitialChildren: function finalizeInitialChildren(instance) {\n    // https://github.com/facebook/react/issues/20271\n    // Returning true will trigger commitMount\n    return instance.__handlers;\n  },\n  commitMount: function commitMount(instance)\n  /*, type, props*/\n  {\n    // https://github.com/facebook/react/issues/20271\n    // This will make sure events are only added once to the central container\n    var container = instance.__container;\n    if (container && instance.raycast && instance.__handlers) container.__interaction.push(instance);\n  },\n  prepareUpdate: function prepareUpdate() {\n    return emptyObject;\n  },\n  shouldDeprioritizeSubtree: function shouldDeprioritizeSubtree() {\n    return false;\n  },\n  prepareForCommit: function prepareForCommit() {\n    return null;\n  },\n  preparePortalMount: function preparePortalMount() {\n    return null;\n  },\n  resetAfterCommit: function resetAfterCommit() {},\n  shouldSetTextContent: function shouldSetTextContent() {\n    return false;\n  },\n  clearContainer: function clearContainer() {\n    return false;\n  }\n});\nvar hasSymbol = is.fun(Symbol) && Symbol[\"for\"];\nvar REACT_PORTAL_TYPE = hasSymbol ? Symbol[\"for\"]('react.portal') : 0xeaca;\nfunction render(element, container, state) {\n  var root = roots.get(container);\n\n  if (!root) {\n    container.__state = state; // @ts-ignore\n\n    var newRoot = root = Renderer.createContainer(container, state !== undefined && state.current.concurrent ? 2 : 0, false, // @ts-ignore\n    null);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, function () {\n    return undefined;\n  });\n  return Renderer.getPublicRootInstance(root);\n}\nfunction unmountComponentAtNode(container, callback) {\n  var root = roots.get(container);\n\n  if (root) {\n    Renderer.updateContainer(null, root, null, function () {\n      roots[\"delete\"](container);\n      if (callback) callback(container);\n    });\n  }\n}\nfunction createPortal(children, containerInfo, implementation, key) {\n  if (key === void 0) {\n    key = null;\n  }\n\n  if (!containerInfo.__objects) containerInfo.__objects = [];\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children: children,\n    containerInfo: containerInfo,\n    implementation: implementation\n  };\n}\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  //@ts-ignore\n  findHostInstanceByFiber: function findHostInstanceByFiber() {\n    return null;\n  },\n  version: version,\n  rendererPackageName: name\n});\n\nvar threeTypes = /*#__PURE__*/Object.freeze({\n  __proto__: null\n});\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } it = o[Symbol.iterator](); return it.next.bind(it); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nfunction makeId(event) {\n  return (event.eventObject || event.object).uuid + '/' + event.index;\n}\n\nvar stateContext = /*#__PURE__*/React.createContext({});\nvar useCanvas = function useCanvas(props) {\n  var children = props.children,\n      gl = props.gl,\n      camera = props.camera,\n      orthographic = props.orthographic,\n      raycaster = props.raycaster,\n      size = props.size,\n      pixelRatio = props.pixelRatio,\n      _props$vr = props.vr,\n      vr = _props$vr === void 0 ? false : _props$vr,\n      _props$concurrent = props.concurrent,\n      concurrent = _props$concurrent === void 0 ? false : _props$concurrent,\n      _props$shadowMap = props.shadowMap,\n      shadowMap = _props$shadowMap === void 0 ? false : _props$shadowMap,\n      _props$colorManagemen = props.colorManagement,\n      colorManagement = _props$colorManagemen === void 0 ? true : _props$colorManagemen,\n      _props$invalidateFram = props.invalidateFrameloop,\n      invalidateFrameloop = _props$invalidateFram === void 0 ? false : _props$invalidateFram,\n      _props$updateDefaultC = props.updateDefaultCamera,\n      updateDefaultCamera = _props$updateDefaultC === void 0 ? true : _props$updateDefaultC,\n      _props$noEvents = props.noEvents,\n      noEvents = _props$noEvents === void 0 ? false : _props$noEvents,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed,\n      forceResize = props.forceResize; // Local, reactive state\n\n  var _React$useState = React.useState(false),\n      ready = _React$useState[0],\n      setReady = _React$useState[1];\n\n  var _React$useState2 = React.useState(function () {\n    return new THREE.Vector2();\n  }),\n      mouse = _React$useState2[0];\n\n  var _React$useState3 = React.useState(function () {\n    var ray = new THREE.Raycaster();\n\n    if (raycaster) {\n      var filter = raycaster.filter,\n          computeOffsets = raycaster.computeOffsets,\n          raycasterProps = _objectWithoutPropertiesLoose__default['default'](raycaster, [\"filter\", \"computeOffsets\"]);\n\n      applyProps(ray, raycasterProps, {});\n    }\n\n    return ray;\n  }),\n      defaultRaycaster = _React$useState3[0];\n\n  var _React$useState4 = React.useState(function () {\n    var scene = new THREE.Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  }),\n      defaultScene = _React$useState4[0];\n\n  var _React$useState5 = React.useState(function () {\n    var cam = orthographic ? new THREE.OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new THREE.PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {}); // Always look at [0, 0, 0]\n\n    cam.lookAt(0, 0, 0);\n    return cam;\n  }),\n      defaultCam = _React$useState5[0],\n      _setDefaultCamera = _React$useState5[1];\n\n  var _React$useState6 = React.useState(function () {\n    return new THREE.Clock();\n  }),\n      clock = _React$useState6[0]; // Public state\n\n\n  var state = React.useRef({\n    ready: false,\n    active: true,\n    manual: 0,\n    colorManagement: colorManagement,\n    vr: vr,\n    concurrent: concurrent,\n    noEvents: noEvents,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse: mouse,\n    clock: clock,\n    gl: gl,\n    size: size,\n    viewport: null,\n    initialClick: [0, 0],\n    initialHits: [],\n    pointer: new tinyEmitter.TinyEmitter(),\n    captured: undefined,\n    events: undefined,\n    subscribe: function subscribe(ref, priority) {\n      if (priority === void 0) {\n        priority = 0;\n      }\n\n      // If this subscription was given a priority, it takes rendering into its own hands\n      // For that reason we switch off automatic rendering and increase the manual flag\n      // As long as this flag is positive (there could be multiple render subscription)\n      // ..there can be no internal rendering at all\n      if (priority) state.current.manual++;\n      state.current.subscribers.push({\n        ref: ref,\n        priority: priority\n      }); // Sort layers from lowest to highest, meaning, highest priority renders last (on top of the other frames)\n\n      state.current.subscribers = state.current.subscribers.sort(function (a, b) {\n        return a.priority - b.priority;\n      });\n      return function () {\n        var _state$current;\n\n        if ((_state$current = state.current) == null ? void 0 : _state$current.subscribers) {\n          // Decrease manual flag if this subscription had a priority\n          if (priority) state.current.manual--;\n          state.current.subscribers = state.current.subscribers.filter(function (s) {\n            return s.ref !== ref;\n          });\n        }\n      };\n    },\n    setDefaultCamera: function setDefaultCamera(camera) {\n      return _setDefaultCamera(camera);\n    },\n    invalidate: function invalidate$1() {\n      return invalidate(state);\n    },\n    intersect: function intersect(event, prepare) {\n      if (event === void 0) {\n        event = {};\n      }\n\n      if (prepare === void 0) {\n        prepare = true;\n      }\n\n      return handlePointerMove(event, prepare);\n    },\n    forceResize: forceResize\n  });\n  var position = new THREE.Vector3();\n  var getCurrentViewport = React.useCallback(function (camera, target) {\n    if (camera === void 0) {\n      camera = state.current.camera;\n    }\n\n    if (target === void 0) {\n      target = new THREE.Vector3(0, 0, 0);\n    }\n\n    var _state$current$size = state.current.size,\n        width = _state$current$size.width,\n        height = _state$current$size.height;\n    var distance = camera.getWorldPosition(position).distanceTo(target);\n\n    if (isOrthographicCamera(camera)) {\n      return {\n        width: width / camera.zoom,\n        height: height / camera.zoom,\n        factor: 1,\n        distance: distance\n      };\n    } else {\n      var fov = camera.fov * Math.PI / 180; // convert vertical fov to radians\n\n      var h = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      var w = h * (width / height);\n      return {\n        width: w,\n        height: h,\n        factor: width / w,\n        distance: distance\n      };\n    }\n  }, []); // Writes locals into public state for distribution among subscribers, context, etc\n\n  React.useMemo(function () {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n    state.current.gl = gl;\n    state.current.concurrent = concurrent;\n    state.current.noEvents = noEvents; // Make viewport backwards compatible\n\n    state.current.viewport = getCurrentViewport; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [invalidateFrameloop, vr, concurrent, noEvents, ready, size, defaultCam, gl]); // Adjusts default camera\n\n  React.useMemo(function () {\n    state.current.aspect = size.width / size.height; // Assign viewport props to the function\n\n    Object.assign(state.current.viewport, getCurrentViewport()); // https://github.com/drcmda/react-three-fiber/issues/92\n    // Sometimes automatic default camera adjustment isn't wanted behaviour\n\n    if (updateDefaultCamera) {\n      if (isOrthographicCamera(defaultCam)) {\n        defaultCam.left = size.width / -2;\n        defaultCam.right = size.width / 2;\n        defaultCam.top = size.height / 2;\n        defaultCam.bottom = size.height / -2;\n      } else {\n        defaultCam.aspect = state.current.aspect;\n      }\n\n      defaultCam.updateProjectionMatrix(); // https://github.com/react-spring/react-three-fiber/issues/178\n      // Update matrix world since the renderer is a frame late\n\n      defaultCam.updateMatrixWorld();\n    }\n\n    gl.setSize(size.width, size.height);\n    if (ready) invalidate(state); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [defaultCam, gl, size, updateDefaultCamera, ready]); // Only trigger the context provider when necessary\n\n  var sharedState = React.useRef(null);\n  React.useMemo(function () {\n    var _state$current2 = state.current,\n        ready = _state$current2.ready,\n        manual = _state$current2.manual,\n        vr = _state$current2.vr,\n        noEvents = _state$current2.noEvents,\n        invalidateFrameloop = _state$current2.invalidateFrameloop,\n        frames = _state$current2.frames,\n        subscribers = _state$current2.subscribers,\n        captured = _state$current2.captured,\n        initialClick = _state$current2.initialClick,\n        initialHits = _state$current2.initialHits,\n        props = _objectWithoutPropertiesLoose__default['default'](_state$current2, [\"ready\", \"manual\", \"vr\", \"noEvents\", \"invalidateFrameloop\", \"frames\", \"subscribers\", \"captured\", \"initialClick\", \"initialHits\"]);\n\n    sharedState.current = props; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [size, defaultCam]); // Update pixel ratio\n\n  React.useLayoutEffect(function () {\n    if (pixelRatio) {\n      if (Array.isArray(pixelRatio)) gl.setPixelRatio(Math.max(Math.min(pixelRatio[0], window.devicePixelRatio), pixelRatio[1]));else gl.setPixelRatio(pixelRatio);\n    }\n  }, [gl, pixelRatio]); // Update shadow map\n\n  React.useLayoutEffect(function () {\n    if (shadowMap) {\n      gl.shadowMap.enabled = true;\n      if (typeof shadowMap === 'object') Object.assign(gl.shadowMap, shadowMap);else gl.shadowMap.type = THREE.PCFSoftShadowMap;\n    }\n\n    if (colorManagement) {\n      gl.toneMapping = THREE.ACESFilmicToneMapping;\n      gl.outputEncoding = THREE.sRGBEncoding;\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [shadowMap, colorManagement]);\n  /** Events ------------------------------------------------------------------------------------------------ */\n\n  var hovered = React.useMemo(function () {\n    return new Map();\n  }, []);\n  var temp = new THREE.Vector3();\n  /** Sets up defaultRaycaster */\n\n  var prepareRay = React.useCallback(function (event) {\n    // https://github.com/pmndrs/react-three-fiber/pull/782\n    // Events trigger outside of canvas when moved\n    var offsets = (raycaster == null ? void 0 : raycaster.computeOffsets == null ? void 0 : raycaster.computeOffsets(event, sharedState.current)) || event.nativeEvent;\n\n    if (offsets) {\n      var offsetX = offsets.offsetX,\n          offsetY = offsets.offsetY;\n      var _state$current$size2 = state.current.size,\n          width = _state$current$size2.width,\n          height = _state$current$size2.height;\n      mouse.set(offsetX / width * 2 - 1, -(offsetY / height) * 2 + 1);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  var intersect = React.useCallback(function (filter) {\n    // Skip event handling when noEvents is set\n    if (state.current.noEvents) return [];\n    var seen = new Set();\n    var hits = []; // Allow callers to eliminate event objects\n\n    var eventsObjects = filter ? filter(state.current.scene.__interaction) : state.current.scene.__interaction; // Intersect known handler objects and filter against duplicates\n\n    var intersects = defaultRaycaster.intersectObjects(eventsObjects, true).filter(function (item) {\n      var id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    }); // https://github.com/mrdoob/three.js/issues/16031\n    // Allow custom userland intersect sort order\n\n    if (raycaster && raycaster.filter && sharedState.current) {\n      intersects = raycaster.filter(intersects, sharedState.current);\n    }\n\n    for (var _iterator = _createForOfIteratorHelperLoose(intersects), _step; !(_step = _iterator()).done;) {\n      var _intersect = _step.value;\n      var eventObject = _intersect.object; // Bubble event up\n\n      while (eventObject) {\n        var handlers = eventObject.__handlers;\n        if (handlers) hits.push(_extends__default['default']({}, _intersect, {\n          eventObject: eventObject\n        }));\n        eventObject = eventObject.parent;\n      }\n    }\n\n    return hits;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  /**  Calculates click deltas */\n\n  var calculateDistance = React.useCallback(function (event) {\n    var dx = event.nativeEvent.offsetX - state.current.initialClick[0];\n    var dy = event.nativeEvent.offsetY - state.current.initialClick[1];\n    return Math.round(Math.sqrt(dx * dx + dy * dy));\n  }, []);\n  var handlePointerCancel = React.useCallback(function (event, hits, prepare) {\n    if (prepare === void 0) {\n      prepare = true;\n    }\n\n    state.current.pointer.emit('pointerCancel', event);\n    if (prepare) prepareRay(event);\n    Array.from(hovered.values()).forEach(function (hoveredObj) {\n      // When no objects were hit or the the hovered object wasn't found underneath the cursor\n      // we call onPointerOut and delete the object from the hovered-elements map\n      if (hits && (!hits.length || !hits.find(function (hit) {\n        return hit.object === hoveredObj.object && hit.index === hoveredObj.index;\n      }))) {\n        var eventObject = hoveredObj.eventObject;\n        var handlers = eventObject.__handlers;\n        hovered[\"delete\"](makeId(hoveredObj));\n\n        if (handlers) {\n          // Clear out intersects, they are outdated by now\n          var data = _extends__default['default']({}, hoveredObj, {\n            intersections: hits || []\n          });\n\n          if (handlers.pointerOut) handlers.pointerOut(_extends__default['default']({}, data, {\n            type: 'pointerout'\n          }));\n          if (handlers.pointerLeave) handlers.pointerLeave(_extends__default['default']({}, data, {\n            type: 'pointerleave'\n          }));\n        }\n      }\n    }); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  /**  Creates filtered intersects and returns an array of positive hits */\n\n  var getIntersects = React.useCallback(function (event, filter) {\n    // Get fresh intersects\n    var intersections = intersect(filter); // If the interaction is captured take that into account, the captured event has to be part of the intersects\n\n    if (state.current.captured && event.type !== 'click' && event.type !== 'wheel') {\n      state.current.captured.forEach(function (captured) {\n        if (!intersections.find(function (hit) {\n          return hit.eventObject === captured.eventObject;\n        })) intersections.push(captured);\n      });\n    }\n\n    return intersections;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  var handleIntersects = React.useCallback(function (intersections, event, fn) {\n    // If anything has been found, forward it to the event listeners\n    if (intersections.length) {\n      (function () {\n        var unprojectedPoint = temp.set(mouse.x, mouse.y, 0).unproject(state.current.camera);\n        var delta = event.type === 'click' ? calculateDistance(event) : 0;\n\n        var releasePointerCapture = function releasePointerCapture(id) {\n          return event.target.releasePointerCapture(id);\n        };\n\n        var localState = {\n          stopped: false,\n          captured: false\n        };\n\n        var _loop = function _loop() {\n          var hit = _step2.value;\n\n          var setPointerCapture = function setPointerCapture(id) {\n            // If the hit is going to be captured flag that we're in captured state\n            if (!localState.captured) {\n              localState.captured = true; // The captured hit array is reset to collect hits\n\n              state.current.captured = [];\n            } // Push hits to the array\n\n\n            if (state.current.captured) {\n              state.current.captured.push(hit);\n            } // Call the original event now\n            event.target.setPointerCapture(id);\n          };\n\n          var raycastEvent = _extends__default['default']({}, event, hit, {\n            intersections: intersections,\n            stopped: localState.stopped,\n            delta: delta,\n            unprojectedPoint: unprojectedPoint,\n            ray: defaultRaycaster.ray,\n            camera: state.current.camera,\n            // Hijack stopPropagation, which just sets a flag\n            stopPropagation: function stopPropagation() {\n              // https://github.com/react-spring/react-three-fiber/issues/596\n              // Events are not allowed to stop propagation if the pointer has been captured\n              var cap = state.current.captured;\n\n              if (!cap || cap.find(function (h) {\n                return h.eventObject.id === hit.eventObject.id;\n              })) {\n                raycastEvent.stopped = localState.stopped = true; // Propagation is stopped, remove all other hover records\n                // An event handler is only allowed to flush other handlers if it is hovered itself\n\n                if (hovered.size && Array.from(hovered.values()).find(function (i) {\n                  return i.eventObject === hit.eventObject;\n                })) {\n                  // Objects cannot flush out higher up objects that have already caught the event\n                  var higher = intersections.slice(0, intersections.indexOf(hit));\n                  handlePointerCancel(raycastEvent, [].concat(higher, [hit]));\n                }\n              }\n            },\n            target: _extends__default['default']({}, event.target, {\n              setPointerCapture: setPointerCapture,\n              releasePointerCapture: releasePointerCapture\n            }),\n            currentTarget: _extends__default['default']({}, event.currentTarget, {\n              setPointerCapture: setPointerCapture,\n              releasePointerCapture: releasePointerCapture\n            }),\n            sourceEvent: event\n          });\n\n          fn(raycastEvent); // Event bubbling may be interrupted by stopPropagation\n\n          if (localState.stopped === true) return \"break\";\n        };\n\n        for (var _iterator2 = _createForOfIteratorHelperLoose(intersections), _step2; !(_step2 = _iterator2()).done;) {\n          var _ret = _loop();\n\n          if (_ret === \"break\") break;\n        }\n      })();\n    }\n\n    return intersections;\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  var handlePointerMove = React.useCallback(function (event, prepare) {\n    if (prepare === void 0) {\n      prepare = true;\n    }\n\n    state.current.pointer.emit('pointerMove', event);\n    if (prepare) prepareRay(event);\n    var hits = getIntersects(event, // This is onPointerMove, we're only interested in events that exhibit this particular event\n    function (objects) {\n      return objects.filter(function (obj) {\n        return ['Move', 'Over', 'Enter', 'Out', 'Leave'].some(function (name) {\n          return obj.__handlers['pointer' + name];\n        });\n      });\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    handleIntersects(hits, event, function (data) {\n      var eventObject = data.eventObject;\n      var handlers = eventObject.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerEnter || handlers.pointerOut || handlers.pointerLeave) {\n        var id = makeId(data);\n        var hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends__default['default']({}, data, {\n            type: 'pointerover'\n          }));\n          if (handlers.pointerEnter) handlers.pointerEnter(_extends__default['default']({}, data, {\n            type: 'pointerenter'\n          }));\n        } else if (hoveredItem.stopped) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation();\n        }\n      } // Call mouse move\n\n\n      if (handlers.pointerMove) handlers.pointerMove(data);\n    });\n    return hits; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  var handlePointer = React.useCallback(function (name) {\n    return function (event, prepare) {\n      if (prepare === void 0) {\n        prepare = true;\n      }\n\n      state.current.pointer.emit(name, event);\n      if (prepare) prepareRay(event);\n      var hits = getIntersects(event);\n      handleIntersects(hits, event, function (data) {\n        var eventObject = data.eventObject;\n        var handlers = eventObject.__handlers;\n\n        if (handlers && handlers[name]) {\n          // Forward all events back to their respective handlers with the exception of click events,\n          // which must use the initial target\n          if (name !== 'click' && name !== 'contextMenu' && name !== 'doubleClick' || state.current.initialHits.includes(eventObject)) {\n            handlers[name](data);\n            pointerMissed(event, defaultScene.__interaction, function (object) {\n              return object !== eventObject;\n            });\n          }\n        }\n      }); // If a click yields no results, pass it back to the user as a miss\n\n      if (name === 'pointerDown') {\n        state.current.initialClick = [event.nativeEvent.offsetX, event.nativeEvent.offsetY];\n        state.current.initialHits = hits.map(function (hit) {\n          return hit.eventObject;\n        });\n      }\n\n      if ((name === 'click' || name === 'contextMenu' || name === 'doubleClick') && !hits.length) {\n        if (calculateDistance(event) <= 2) {\n          pointerMissed(event, defaultScene.__interaction);\n          if (onPointerMissed) onPointerMissed();\n        }\n      }\n    };\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  [onPointerMissed, calculateDistance, getIntersects, handleIntersects, prepareRay]);\n  React.useMemo(function () {\n    state.current.events = {\n      onClick: handlePointer('click'),\n      onContextMenu: handlePointer('contextMenu'),\n      onDoubleClick: handlePointer('doubleClick'),\n      onWheel: handlePointer('wheel'),\n      onPointerDown: handlePointer('pointerDown'),\n      onPointerUp: handlePointer('pointerUp'),\n      onPointerLeave: function onPointerLeave(e) {\n        return handlePointerCancel(e, []);\n      },\n      onPointerMove: handlePointerMove,\n      // onGotPointerCapture is not needed any longer because the behaviour is hacked into\n      // the event itself (see handleIntersects). But in order for non-web targets to simulate\n      // it we keep the legacy event, which simply flags all current intersects as captured\n      onGotPointerCaptureLegacy: function onGotPointerCaptureLegacy(e) {\n        return state.current.captured = intersect();\n      },\n      onLostPointerCapture: function onLostPointerCapture(e) {\n        return state.current.captured = undefined, handlePointerCancel(e);\n      }\n    };\n  }, [handlePointer, intersect, handlePointerCancel, handlePointerMove]);\n  /** Events ------------------------------------------------------------------------------------------------- */\n  // This component is a bridge into the three render context, when it gets rendered\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  var Canvas = React.useCallback(function Canvas(props) {\n    var activate = function activate() {\n      return setReady(true);\n    }; // Pre-compile all materials before rendering out the first time\n\n\n    React.useLayoutEffect(function () {\n      return void gl.compile(defaultScene, defaultCam);\n    }, []);\n    React.useEffect(function () {\n      var result = onCreated && onCreated(state.current);\n      if (result && result.then) result.then(activate);else activate();\n    }, []);\n    return props.children;\n  }, // The Canvas component has to be static, it should not be re-created ever\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  []); // Render v-dom into scene\n\n  React.useLayoutEffect(function () {\n    render( /*#__PURE__*/React.createElement(Canvas, null, /*#__PURE__*/React.createElement(stateContext.Provider, {\n      value: sharedState.current\n    }, typeof children === 'function' ? children(state.current) : children)), defaultScene, state); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [ready, children, sharedState.current]);\n  React.useLayoutEffect(function () {\n    if (ready) {\n      // Start render-loop, either via RAF or setAnimationLoop for VR\n      if (!state.current.vr) {\n        if (state.current.frames === 0) invalidate(state);\n      } else if ((gl.xr || gl.vr) && gl.setAnimationLoop) {\n        (gl.xr || gl.vr).enabled = true;\n        gl.setAnimationLoop(function (t) {\n          return renderGl(state, t, 0, true);\n        });\n      } else {\n        console.warn('the gl instance does not support VR!');\n      }\n    }\n  }, [gl, ready, invalidateFrameloop]); // Dispose renderer on unmount\n\n  React.useEffect(function () {\n    return function () {\n      if (state.current.gl) {\n        if (state.current.gl.renderLists) state.current.gl.renderLists.dispose();\n        if (state.current.gl.forceContextLoss) state.current.gl.forceContextLoss();\n        dispose(state.current.gl);\n      }\n\n      unmountComponentAtNode(state.current.scene, function () {\n        dispose(state.current.raycaster);\n        dispose(state.current.camera);\n        dispose(state.current);\n      });\n    };\n  }, []);\n  return state.current.events;\n};\n\nfunction pointerMissed(event, objects, filter) {\n  if (filter === void 0) {\n    filter = function filter(object) {\n      return true;\n    };\n  }\n\n  objects.filter(filter).forEach(function (object) {\n    var _handlers$pointerMis, _handlers;\n\n    return (_handlers$pointerMis = (_handlers = object.__handlers).pointerMissed) == null ? void 0 : _handlers$pointerMis.call(_handlers, event);\n  });\n}\n\nfunction dispose(obj) {\n  if (obj.dispose && obj.type !== 'Scene') obj.dispose();\n\n  for (var p in obj) {\n    if (typeof p === 'object' && p.dispose) p.dispose();\n    delete obj[p];\n  }\n}\n\nfunction useContext(context) {\n  var result = React.useContext(context);\n\n  if (!('subscribe' in result)) {\n    throw new Error(\"\\u26A1\\uFE0F react-three-fiber hooks can only be used within the Canvas component! https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#hooks\");\n  }\n\n  return result;\n}\n\nfunction useFrame(callback, renderPriority) {\n  if (renderPriority === void 0) {\n    renderPriority = 0;\n  }\n\n  var _useContext = useContext(stateContext),\n      subscribe = _useContext.subscribe; // Update ref\n\n\n  var ref = React.useRef(callback);\n  React.useLayoutEffect(function () {\n    return void (ref.current = callback);\n  }, [callback]); // Subscribe/unsub\n\n  React.useEffect(function () {\n    var unsubscribe = subscribe(ref, renderPriority);\n    return function () {\n      return unsubscribe();\n    };\n  }, [renderPriority, subscribe]);\n  return null;\n}\nfunction useThree() {\n  return useContext(stateContext);\n}\nfunction useUpdate(callback, dependents, optionalRef) {\n  var _useContext2 = useContext(stateContext),\n      invalidate = _useContext2.invalidate;\n\n  var localRef = React.useRef();\n  var ref = optionalRef ? optionalRef : localRef;\n  React.useLayoutEffect(function () {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return ref;\n}\nfunction useResource(optionalRef) {\n  var _useState = React.useState(false),\n      _ = _useState[0],\n      forceUpdate = _useState[1];\n\n  var localRef = React.useRef(undefined);\n  var ref = optionalRef ? optionalRef : localRef;\n  React.useLayoutEffect(function () {\n    return void forceUpdate(function (i) {\n      return !i;\n    });\n  }, []);\n  return ref;\n}\n\nfunction buildGraph(object) {\n  var data = {\n    nodes: {},\n    materials: {}\n  };\n\n  if (object) {\n    object.traverse(function (obj) {\n      if (obj.name) data.nodes[obj.name] = obj;\n      if (obj.material && !data.materials[obj.material.name]) data.materials[obj.material.name] = obj.material;\n    });\n  }\n\n  return data;\n}\n\nfunction useGraph(object) {\n  return React.useMemo(function () {\n    return buildGraph(object);\n  }, [object]);\n}\n\nfunction loadingFn(extensions, onProgress) {\n  return function (Proto) {\n    // Construct new loader and run extensions\n    var loader = new Proto();\n    if (extensions) extensions(loader); // Go through the urls and load them\n\n    for (var _len = arguments.length, input = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      input[_key - 1] = arguments[_key];\n    }\n\n    return Promise.all(input.map(function (input) {\n      return new Promise(function (res, reject) {\n        return loader.load(input, function (data) {\n          if (data.scene) Object.assign(data, buildGraph(data.scene));\n          res(data);\n        }, onProgress, function (error) {\n          var _error$message;\n\n          return reject((_error$message = error.message) != null ? _error$message : \"failure loading \" + input);\n        });\n      });\n    }));\n  };\n}\n\nfunction useLoader(Proto, input, extensions, onProgress) {\n  // Use suspense to load async assets\n  var keys = Array.isArray(input) ? input : [input];\n  var results = useAsset.useAsset.apply(void 0, [loadingFn(extensions, onProgress), Proto].concat(keys)); // Return the object/s\n\n  return Array.isArray(input) ? results : results[0];\n}\n\nuseLoader.preload = function (Proto, input, extensions) {\n  var keys = Array.isArray(input) ? input : [input];\n  return useAsset.useAsset.preload.apply(useAsset.useAsset, [loadingFn(extensions), Proto].concat(keys));\n};\n\nvar defaultStyles = {\n  position: 'relative',\n  width: '100%',\n  height: '100%',\n  overflow: 'hidden'\n};\n\nfunction Content(_ref) {\n  var children = _ref.children,\n      setEvents = _ref.setEvents,\n      container = _ref.container,\n      renderer = _ref.renderer,\n      effects = _ref.effects,\n      props = _objectWithoutPropertiesLoose__default['default'](_ref, [\"children\", \"setEvents\", \"container\", \"renderer\", \"effects\"]);\n\n  // Create renderer\n  var _useState = React.useState(renderer),\n      gl = _useState[0];\n\n  if (!gl) console.warn('No renderer created!'); // Mount and unmount management\n\n  React.useEffect(function () {\n    if (effects) effects(gl, container);\n  }, [container, effects, gl]); // Init canvas, fetch events, hand them back to the wrapping div\n\n  var events = useCanvas(_extends__default['default']({}, props, {\n    children: children,\n    gl: gl\n  }));\n  React.useEffect(function () {\n    setEvents(events);\n  }, [events, setEvents]);\n  return null;\n}\n\nvar ResizeContainer = /*#__PURE__*/React__default['default'].memo(function ResizeContainer(props) {\n  var renderer = props.renderer,\n      effects = props.effects,\n      children = props.children,\n      vr = props.vr,\n      webgl1 = props.webgl1,\n      concurrent = props.concurrent,\n      shadowMap = props.shadowMap,\n      colorManagement = props.colorManagement,\n      orthographic = props.orthographic,\n      invalidateFrameloop = props.invalidateFrameloop,\n      updateDefaultCamera = props.updateDefaultCamera,\n      noEvents = props.noEvents,\n      gl = props.gl,\n      camera = props.camera,\n      raycaster = props.raycaster,\n      pixelRatio = props.pixelRatio,\n      onCreated = props.onCreated,\n      onPointerMissed = props.onPointerMissed,\n      preRender = props.preRender,\n      resize = props.resize,\n      style = props.style,\n      restSpread = _objectWithoutPropertiesLoose__default['default'](props, [\"renderer\", \"effects\", \"children\", \"vr\", \"webgl1\", \"concurrent\", \"shadowMap\", \"colorManagement\", \"orthographic\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"noEvents\", \"gl\", \"camera\", \"raycaster\", \"pixelRatio\", \"onCreated\", \"onPointerMissed\", \"preRender\", \"resize\", \"style\"]);\n\n  var containerRef = React.useRef(); // onGotPointerCaptureLegacy is a fake event used by non-web targets to simulate poinzter capture\n\n  var _useState2 = React.useState({}),\n      _useState2$ = _useState2[0],\n      onGotPointerCaptureLegacy = _useState2$.onGotPointerCaptureLegacy,\n      events = _objectWithoutPropertiesLoose__default['default'](_useState2$, [\"onGotPointerCaptureLegacy\"]),\n      setEvents = _useState2[1];\n\n  var _useMeasure = useMeasure__default['default'](_extends__default['default']({\n    scroll: true,\n    debounce: {\n      scroll: 50,\n      resize: 0\n    }\n  }, resize)),\n      bind = _useMeasure[0],\n      size = _useMeasure[1],\n      forceResize = _useMeasure[2]; // Flag view ready once it's been measured out\n\n\n  var readyFlag = React.useRef(false);\n  var ready = React.useMemo(function () {\n    return readyFlag.current = readyFlag.current || !!size.width && !!size.height;\n  }, [size]);\n  var state = React.useMemo(function () {\n    return {\n      size: size,\n      forceResize: forceResize,\n      setEvents: setEvents,\n      container: containerRef.current\n    };\n  }, [forceResize, size]); // Allow Gatsby, Next and other server side apps to run. Will output styles to reduce flickering.\n\n  if (typeof window === 'undefined') return /*#__PURE__*/React__default['default'].createElement(\"div\", _extends__default['default']({\n    style: _extends__default['default']({}, defaultStyles, style)\n  }, restSpread), preRender); // Render the canvas into the dom\n\n  return /*#__PURE__*/React__default['default'].createElement(\"div\", _extends__default['default']({\n    ref: mergeRefs__default['default']([bind, containerRef]),\n    style: _extends__default['default']({}, defaultStyles, style)\n  }, events, restSpread), preRender, ready && /*#__PURE__*/React__default['default'].createElement(Content, _extends__default['default']({}, props, state)));\n});\n\nvar Canvas = /*#__PURE__*/React__default['default'].memo(function Canvas(_ref) {\n  var children = _ref.children,\n      props = _objectWithoutPropertiesLoose__default['default'](_ref, [\"children\"]);\n\n  var canvasRef = React.useRef();\n\n  var _renderer = props.webgl1 ? THREE.WebGL1Renderer : THREE.WebGLRenderer;\n\n  return /*#__PURE__*/React__default['default'].createElement(ResizeContainer, _extends__default['default']({}, props, {\n    renderer: function renderer() {\n      if (canvasRef.current) {\n        var params = _extends__default['default']({\n          antialias: true,\n          alpha: true\n        }, props.gl);\n\n        var temp = new _renderer(_extends__default['default']({\n          powerPreference: 'high-performance',\n          //stencil: false,\n          //depth: false,\n          canvas: canvasRef.current\n        }, params));\n        return temp;\n      }\n    },\n    preRender: /*#__PURE__*/React__default['default'].createElement(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'block'\n      }\n    })\n  }), children);\n});\n\nexports.Canvas = Canvas;\nexports.ReactThreeFiber = threeTypes;\nexports.Renderer = Renderer;\nexports.ResizeContainer = ResizeContainer;\nexports.addAfterEffect = addAfterEffect;\nexports.addEffect = addEffect;\nexports.addTail = addTail;\nexports.applyProps = applyProps;\nexports.createPortal = createPortal;\nexports.extend = extend;\nexports.forceResize = forceResize;\nexports.invalidate = invalidate;\nexports.isOrthographicCamera = isOrthographicCamera;\nexports.render = render;\nexports.renderGl = renderGl;\nexports.stateContext = stateContext;\nexports.unmountComponentAtNode = unmountComponentAtNode;\nexports.useCanvas = useCanvas;\nexports.useFrame = useFrame;\nexports.useGraph = useGraph;\nexports.useLoader = useLoader;\nexports.useResource = useResource;\nexports.useThree = useThree;\nexports.useUpdate = useUpdate;\n"]},"metadata":{},"sourceType":"script"}